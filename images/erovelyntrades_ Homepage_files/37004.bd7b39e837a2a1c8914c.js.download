"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[37004],{874200:(e,t,s)=>{s.d(t,{SessionInfo:()=>o,BarBuilderBase:()=>a});var r=s(393987),n=s(370062),i=s(797753);class o{constructor(e,t,s,r){this.init(e,t,s,r),this._state={timezone:e,spec:t,holidays:s,corrections:r}}init(e,t,s,n){this.timezone=r.get_timezone(e),this.spec=new i.SessionSpec(e,t,s,n)}state(){return this._state}static fromState(e){return new o(e.timezone,e.spec,e.holidays,e.corrections)}}class a{alignTime(e){if(isNaN(e))return NaN;let t=this.indexOfBar(e);return t===n.SessionStage.POST_SESSION&&(this.moveTo(e),t=this.indexOfBar(e)),t<0?NaN:this.startOfBar(t)}}},212666:(e,t,s)=>{s.d(t,{BusinessDay:()=>n});var r=s(393987);class n{constructor(e,t,s){this.year=e,this.month=t,this.day=s}toString(){return`${this.year}-${this.month}-${this.day}`}compareTo(e){return this.year>e.year||this.year===e.year&&this.month>e.month||this.year===e.year&&this.month===e.month&&this.day>e.day?1:this.year===e.year&&this.month===e.month&&this.day===e.day?0:-1}before(e){return-1===this.compareTo(e)}toCalendar(e){return r.get_cal(r.get_timezone("Etc/UTC"),this.year,this.month-1,this.day)}addDays(e){const t=this.toCalendar(r.get_timezone("Etc/UTC"));return r.add_date(t,e),n.fromCalendar(t)}static fromCalendar(e){return new n(r.get_year(e),r.get_month(e)+1,r.get_day_of_month(e))}}},370062:(e,t,s)=>{var r;s.d(t,{SessionStage:()=>r}),function(e){e[e.PRE_SESSION=-1]="PRE_SESSION",e[e.POST_SESSION=-2]="POST_SESSION",e[e.LASTBAR_SESSION=-3]="LASTBAR_SESSION"}(r||(r={}))},797753:(e,t,s)=>{s.d(t,{SessionSpec:()=>p});var r=s(393987),n=s(377884),i=s(212666);function o(e,t){return e.compareTo(t)}class a{constructor(e,t,s){this._dayOfWeek=e,this._start=t,this._length=s}start(){return this._start+r.minutesPerDay*this.sessionStartDaysOffset()}startOffset(){return this._start}sessionStartDaysOffset(){return this._start>=0?0:this._start%r.minutesPerDay==0?-Math.ceil(this._start/r.minutesPerDay):-Math.floor(this._start/r.minutesPerDay)}sessionEndDaysOffset(){const e=this._start+this._length;return e>=0?0:e%r.minutesPerDay==0?-Math.ceil(e/r.minutesPerDay):-Math.floor(e/r.minutesPerDay)}isOvernight(){return this._start<0}dayOfWeek(){return this._dayOfWeek}sessionStartDayOfWeek(){let e=this._dayOfWeek-this.sessionStartDaysOffset();return e<r.SUNDAY&&(e+=7),e}sessionEndDayOfWeek(){let e=this.sessionStartDayOfWeek()+this.sessionEndDaysOffset();return e>r.SATURDAY&&(e=1),e}length(){return this._length}weight(){return this._dayOfWeek*r.minutesPerDay+this._start}compareTo(e){const t=this.weight(),s=t+this._length,r=e.weight(),n=r+e._length;return t<=r&&r<s||r<=t&&t<n?0:t>r?1:-1}contains(e){const t=60*r.get_hours(e)+r.get_minutes(e);let s=r.get_day_of_week(e)-this._dayOfWeek;s>0&&(s-=7);const n=s*r.minutesPerDay+t;return n>=this._start&&n<this._start+this._length}}class h{constructor(e,t,s){this.weekIndex=e,this.entryIndex=t,this.entries=s}getEntry(){return this.entries[this.entryIndex]}}var c=s(911905)
;const d=[r.MONDAY,r.TUESDAY,r.WEDNESDAY,r.THURSDAY,r.FRIDAY],l=[r.SUNDAY,r.MONDAY,r.TUESDAY,r.WEDNESDAY,r.THURSDAY,r.FRIDAY,r.SATURDAY],u=(0,c.getLogger)("Chart.Model.SessionSpec");function _(e){return e>=48&&e<=57}class f{constructor(){this.entries=[],this.firstDayOfWeek=r.MONDAY,this.weekEndsCount=-1,this.maxTradingDayLength=0}parseSessions(e,t){var s;let r=!1;this._clear(),this.timezone=e;const{hasErrors:n,spec:i}=this._parseFirstDayOfWeek(t);if("24x7"===i.toLowerCase())for(const e of l)this.entries.push(f._createSessionEntry(e,0,0,0,0));else{let e=!1;const t=new Map;for(const s of i.split("|")){const n=s.split(":");if(1!==n.length&&2!==n.length){r=!0,u.logError(`Bad session section: ${s}`);continue}const i=1===n.length;if(i){if(e){r=!0,u.logError(`Duplicated default section: ${s}`);continue}e=!0}const o=i?d:f._parseWorkingDays(n[1]);for(const e of o)i&&t.has(e)||t.set(e,n[0])}for(const e of l){const s=t.get(e);if(void 0!==s)for(const t of s.split(",")){const{hasErrors:s,sessionEntry:n}=f._parseSessionEntry(e,t);s&&(r=s),this.entries.push(n)}}}this.entries.sort(o);const a=new Map;for(const e of this.entries){const t=e.dayOfWeek();a.set(t,e.length()+(null!==(s=a.get(t))&&void 0!==s?s:0))}return this.maxTradingDayLength=0,a.forEach((e=>{this.maxTradingDayLength=Math.max(this.maxTradingDayLength,e)})),this.weekEndsCount=7-a.size,r||n}static parseHolidaysAndCorrections(e,t,s){const n=new Map,i=new Map,o=e=>{const t=this._parseDay(e),s=t.toString(),r=i.get(s);return void 0!==r?r:(i.set(s,t),t)};if(""!==t){const e=[];for(const s of t.split(",")){if(8!==s.length)throw new Error(`bad holiday date: ${s}`);const t=o(s);n.set(t,e)}}if(""===s)return n;const h=r.get_timezone("Etc/UTC");for(const e of s.split(";")){const t=e.split(":");if(2!==t.length)throw new Error(`bad correction section: ${e}`);const s=[];if("dayoff"!==t[0])for(const e of t[0].split(","))s.push(this._parseSessionEntry(1,e).sessionEntry);for(const e of t[1].split(",")){if(8!==e.length)throw new Error(`bad correction date: ${e}`);const t=o(e),i=r.get_day_of_week(r.get_cal(h,t.year,t.month-1,t.day)),c=[];for(const e of s)c.push(new a(i,e.startOffset(),e.length()));n.set(t,c)}}return n}_clear(){this.entries=[],this.timezone="",this.firstDayOfWeek=r.MONDAY,this.weekEndsCount=-1}_parseFirstDayOfWeek(e){const t=e.split(";");if(t.length>2)return u.logError(`Only one \`first day\` specification expected @ session ${e}`),{hasErrors:!0,spec:e};if(1===t.length)return{hasErrors:!1,spec:e};let s=1;let n=t[0].indexOf("-")>=0?NaN:parseInt(t[0]);return isNaN(n)&&(s=0,n=parseInt(t[1])),n<r.SUNDAY||n>r.SATURDAY?(u.logError(`Unexpected day index @ session: ${e}; day index ${n}`),{hasErrors:!0,spec:e}):(this.firstDayOfWeek=n,{hasErrors:!1,spec:t[s]})}static _parseDay(e){const t=parseInt(e.substring(0,4)),s=parseInt(e.substring(4,6)),r=parseInt(e.substring(6,8));return new i.BusinessDay(t,s,r)}static _parseSessionEntry(e,t){let s=!1,r=t.split("-");2!==r.length&&(s=!0,u.logError(`Bad sessions entry: ${t}`),r=["0000","0000"]);let n=0,i=r[0];if(i.includes("F")){
const e=i.split("F");i=e[0],n=""!==e[1]?parseInt(e[1]):1}let o=0,a=r[1];if(a.includes("F")){const e=a.split("F");a=e[0],o=""!==e[1]?parseInt(e[1]):1}if(!this._isCorrectSession(i)||!this._isCorrectSession(a))throw new Error(`Incorrect entry syntax: ${t}`);const h=i,c=a;return{hasErrors:s,sessionEntry:this._createSessionEntry(e,f._minutesFromHHMM(h),f._minutesFromHHMM(c),n,o)}}static _isCorrectSession(e){return 4===e.length&&_(e.charCodeAt(0))&&_(e.charCodeAt(1))&&_(e.charCodeAt(2))&&_(e.charCodeAt(3))}static _parseWorkingDays(e){const t=[];for(let s=0;s<e.length;s++){const r=+e[s];-1===t.indexOf(r)&&t.push(r)}return t}static _minutesFromHHMM(e){return r.get_minutes_from_hhmm(e)}static _createSessionEntry(e,t,s,n,i){0===s&&(s=r.minutesPerDay),n===i&&s<=t&&(n+=1),n>0&&(t-=n*r.minutesPerDay),i>0&&(s-=i*r.minutesPerDay);return new a(e,t,s-t)}}function y(e,t){return e.compareTo(t)<0}function g(e,t){const s=(0,n.lowerbound)(e,t,((e,t)=>-1===e.day.compareTo(t)));return s===e.length?null:e[s]}const m=621672192e5;class p{constructor(e="Etc/UTC",t="0000-0000",s="",n=""){this._entries=[],this._firstDayOfWeek=r.MONDAY,this._entriesHash=new Map,this._holidayAndCorrectionMap=new Map,this._holidaySessions=[];const i=new f;i.parseSessions(e,t),this._entries=i.entries,this._timezone=i.timezone,this._spec=t,this._firstDayOfWeek=i.firstDayOfWeek,this._weekEndsCount=i.weekEndsCount,this._maxTradingDayLength=i.maxTradingDayLength;const o=f.parseHolidaysAndCorrections(e,s,n),a=r.get_timezone(e);this._isThereCorrections=""!==s||""!==n,o.forEach(((e,t)=>{this._holidayAndCorrectionMap.set(t.toString(),e),this._holidaySessions.push({day:t,sessions:e});const s=this.getWeekIndex(t.toCalendar(a));this._entriesHash.set(s,null)})),this._holidaySessions.sort(((e,t)=>e.day.compareTo(t.day)))}entries(){return this._entries}timezone(){return this._timezone}spec(){return this._spec}firstDayOfWeek(){return this._firstDayOfWeek}addSessionEntry(e,t,s,n,i){0===s&&(s=r.minutesPerDay),n===i&&s<=t&&(n+=1),n>0&&(t-=n*r.minutesPerDay),i>0&&(s-=i*r.minutesPerDay);const o=s-t;this._entries.push(new a(e,t,o))}longestSessionLength(){let e=0,t=0;for(const t of this._holidaySessions)t.sessions.forEach((t=>{e=Math.max(e,t.length())}));return this._entries.forEach((e=>{t=Math.max(t,e.length())})),Math.max(e,t)}isWeekEnd(e){const t=(0,n.lowerbound)(this._entries,new a(e,0,0),((e,t)=>e.dayOfWeek()<t.dayOfWeek()));return t>this._entries.length-1||this._entries[t].dayOfWeek()!==e}isCalWeekEnd(e){const t=r.get_day_of_week(e);if(!this._isThereCorrections)return this.isWeekEnd(t);const s=i.BusinessDay.fromCalendar(e),n=this._holidayAndCorrectionMap.get(s.toString());return void 0===n?this.isWeekEnd(t):0===n.length}hasWeekEnds(){return this.weekEndsCount()>0}weekEndsCount(){return this._weekEndsCount}maxTradingDayLength(){return this._maxTradingDayLength}holidaysFromYearStart(e){if(!this._isThereCorrections)return 0;const t=r.get_timezone(this._timezone),s=new i.BusinessDay(r.get_year(e),r.JANUARY,1),n=i.BusinessDay.fromCalendar(e);let o=0;const a=this._selectHolidays(s,n)
;for(let e=0;e<a.length;e++){const s=a[e].day.toCalendar(t);this.isWeekEnd(r.get_day_of_week(s))?o+=0===a[e].sessions.length?0:-1:o+=0===a[e].sessions.length?1:0}return o}intradayCanBeBuiltFrom24x7(e){return this._entries.every((t=>t.start()%e==0&&t.length()%e==0))}indexOfSession(e,t,s){const i=this._getEntriesForWeek(e);let o=(0,n.lowerbound)(i,new a(t,s,0),y);if(o!==i.length)return new h(e,o,i);let c=e;const d=7-t+this._firstDayOfWeek-1;for(s=-(r.minutesPerDay-s+d*r.minutesPerDay);;){c++;const e=this._getEntriesForWeek(c);if(0!==e.length)return o=(0,n.lowerbound)(e,new a(this._firstDayOfWeek,s,0),y),new h(c,o,e)}}findSession(e,t,s,r=0){const n=this.indexOfSession(e,t,s),i=n.entries;let o=n.entryIndex;if(0!==r){const e=i[o].dayOfWeek(),t=r>0?1:-1;for(;;){const s=o+t;if(s<0||s>=i.length||i[s].dayOfWeek()!==e)break;o=s}}return new h(n.weekIndex,o,i)}getWeekIndex(e){if(!this._isThereCorrections)return 0;const t=r.get_day_of_week(e)-r.SUNDAY,s=r.get_timezone("Etc/UTC"),n=r.get_cal(s,r.get_year(e),r.get_month(e),r.get_day_of_month(e)-t);return Math.floor((n.getTime()+m)/1e3/86400/7)}correctTradingDay(e){const t=r.get_day_of_week(e),s=60*r.get_hours(e)+r.get_minutes(e),n=this.getWeekIndex(e),i=this.findSession(n,t,s,0),o=i.getEntry().dayOfWeek()-t+7*(i.weekIndex-n);return 0!==o&&r.add_date(e,o),e}alignToSessionStart(e,t=0){const s=r.get_day_of_week(e),n=60*r.get_hours(e)+r.get_minutes(e),i=this.getWeekIndex(e),o=this.findSession(i,s,n,t),a=o.getEntry(),h=a.dayOfWeek()-s+7*(o.weekIndex-i);0!==h&&r.add_date(e,h);const c=a.startOffset();return r.set_hms(e,c/60,c%60,0,0,r.get_timezone(this._timezone)),a.length()}businessDaysToCalendarDays(e,t){let s=this.getWeekIndex(e),n=r.get_day_of_week(e),i=0,o=0;for(;o<t;){const e=this._getEntriesForWeek(s);let a=0;for(let s=n;s<=r.SATURDAY;s++){i++;let r=!0;for(;a<e.length&&!(e[a].dayOfWeek()>s);)e[a].dayOfWeek()<s||r&&(r=!1,o++),a++;if(o>=t)return i}s++,n=r.SUNDAY}return i}calendarDaysToBusinessDays(e,t){let s=this.getWeekIndex(e),n=r.get_day_of_week(e),i=0,o=0;for(;i<t;){const e=this._getEntriesForWeek(s);let a=0;for(let s=n;s<=r.SATURDAY;s++){i++;let r=!0;for(;a<e.length&&!(e[a].dayOfWeek()>s);)e[a].dayOfWeek()<s||r&&(r=!1,o++),a++;if(i>=t)return o}s++,n=r.SUNDAY}return o}alignToNearestSessionStart(e,t){return this._alignToNearestSessionValue(e,t,this._entrySessionStart.bind(this))}alignToNearestSessionEnd(e,t){return this._alignToNearestSessionValue(e,t,this._entrySessionEnd.bind(this))}leftBorderOfDailyBar(e){const t=this._getEntriesForDay(e);return 0===t.length?null:(t.sort(o),this._getLeftEntryBorder(e,t[0]))}bordersOfDailyBar(e){const t=this._getEntriesForDay(e);if(0===t.length)return null;t.sort(o);const s=this._getLeftEntryBorder(e,t[0]),n=t[t.length-1],i=r.clone(e);let a=60*(n.startOffset()+n.length())-1;const h=Math.floor(a/3600);return a-=3600*h,r.set_hms(i,h,a/60,a%60,0,r.get_timezone(this._timezone)),{from:s,to:i}}getEntriesForWeekByCalendar(e){const t=this.getWeekIndex(e);return this._getEntriesForWeek(t)}_getEntriesForWeek(e){let t=this._entriesHash.get(e)
;if(void 0===t)return this._entries;if(null!==t)return t;const s=r.get_timezone(this._timezone);t=this._entries.slice();const n=this._weekIndexToCalendar(e),a=this._weekIndexToCalendar(e+1),h=i.BusinessDay.fromCalendar(n),c=i.BusinessDay.fromCalendar(a),d=this._selectHolidays(h,c);for(const e of d){const n=e.day.toCalendar(s),i=r.get_day_of_week(n);t=t.filter((e=>e.dayOfWeek()!==i)),t=t.concat(e.sessions)}return t.sort(o),this._entriesHash.set(e,t),t}_selectHolidays(e,t){const s=[];let r=e;for(;;){const e=g(this._holidaySessions,r);if(null===e)return s;if(!e.day.before(t))return s;s.push(e),r=e.day.addDays(1)}}_weekIndexToCalendar(e){const t=1e3*(86400*e*7+86400)-m,s=r.get_cal_from_unix_timestamp_ms(r.get_timezone("Etc/UTC"),t),n=r.get_timezone("Etc/UTC");return r.get_cal(n,r.get_year(s),r.get_month(s),r.get_day_of_month(s))}_alignToNearestSessionValue(e,t,s){const n=r.get_day_of_week(e),i=60*r.get_hours(e)+r.get_minutes(e),o=this.getWeekIndex(e);let a=this.findSession(o,n,i);if(a.getEntry().contains(e)&&o===a.weekIndex||1===t)return s(a,r.clone(e),t);const c=a.getEntry(),d=c.contains(e),l=o===a.weekIndex,u=c.sessionStartDaysOffset()-c.dayOfWeek()>=0;if(d&&(l||u))return s(a,r.clone(e),t);let _=a.entryIndex-1;if(_<0){let e=a.weekIndex,t=a.entries;for(;_<0;)e--,t=this._getEntriesForWeek(e),_+=t.length;a=new h(e,_,t)}else a=new h(a.weekIndex,_,a.entries);return s(a,r.clone(e),t)}_entrySessionStart(e,t,s){return this._entrySessionValue(e,t,s,(e=>60*e.start()))}_entrySessionEnd(e,t,s){return this._entrySessionValue(e,t,s,(e=>60*(e.start()+e.length())-1))}_entrySessionValue(e,t,s,n){let i=r.get_day_of_week(t);const o=e.getEntry();let a=o.dayOfWeek()-o.sessionStartDaysOffset();const h=this.getWeekIndex(t);let c=e.weekIndex-h,d=!1;if(a<r.SUNDAY&&(c<=0?d=!0:c--,a+=7),(c>0&&s>=0||c<0&&s<0)&&r.add_date(t,7*c),!o.contains(t)){let e=a-i;d&&s<0&&(e=-(7-a+i)),r.add_date(t,e),i=r.get_day_of_week(t)}o.isOvernight()&&i===o.dayOfWeek()&&r.add_date(t,-o.sessionStartDaysOffset());let l=n(o);const u=Math.floor(l/3600);return l-=3600*u,r.set_hms(t,u,l/60,l%60,0,r.get_timezone(this._timezone)),t}_getEntriesForDay(e){const t=r.get_day_of_week(e);return this._getEntriesForWeek(this.getWeekIndex(e)).filter((e=>e.dayOfWeek()===t))}_getLeftEntryBorder(e,t){const s=r.clone(e),n=t.startOffset();return r.set_hms(s,n/60,n%60,0,0,r.get_timezone(this._timezone)),s}}},908803:(e,t,s)=>{var r;s.d(t,{SymbolErrorPermissionDeniedReason:()=>r,permissionDenied:()=>n,invalidSymbol:()=>i}),function(e){e.Symbol="symbol",e.GroupPermission="group"}(r||(r={}));const n="permission denied",i="invalid symbol"},695078:(e,t,s)=>{s.d(t,{ensureTimePointIndexIndex:()=>o,unpackNonSeriesData:()=>a});var r=s(706617),n=s(588537);function i(e){if(!(0,r.isObject)(e))throw new Error("Graphics commands should be wrapped in an object");if((0,r.hasProperty)(e,"create"),(0,r.hasProperty)(e,"erase")){const t=e.erase;(0,n.assert)(Array.isArray(t),"Collection of erase commands should be array");for(const e of t){if(!(0,r.isObject)(e)||!(0,
r.hasProperty)(e,"action"))throw new Error("Command should be an object with 'action' property");(0,n.assert)("all"===e.action||"one"===e.action,"Erase command action should be 'all' or 'one'")}}return e}function o(e){if(e<0)throw new Error("TimePointIndexIndex should be non-negative integer");return e}async function a(e){if(""===e)return null;const t=JSON.parse(e);if(!(0,r.isObject)(t)||"function"==typeof t)throw new Error("Non-object content in the non-series envelope");if((0,r.hasProperty)(t,"indexes_replace"))return{indexes_replace:!0};const n={indexes_replace:!1};if((0,r.hasProperty)(t,"offsets")&&(n.offsets=t.offsets),(0,r.hasProperty)(t,"isUpdate")){if("boolean"!=typeof t.isUpdate)throw new Error('Invalid type of "isUpdate" field');n.isUpdate=t.isUpdate}if((0,r.hasProperty)(t,"data")&&(n.data=t.data),(0,r.hasProperty)(t,"graphicsCmds")&&(n.graphicsCmds=i(t.graphicsCmds)),(0,r.hasProperty)(t,"dataCompressed")||(0,r.hasProperty)(t,"graphicsCmdsCompressed")){const{default:e}=await Promise.all([s.e(93194),s.e(81578)]).then(s.t.bind(s,593194,23));if((0,r.hasProperty)(t,"dataCompressed")){const s=await(new e).loadAsync(t.dataCompressed,{base64:!0});n.data=JSON.parse(await s.file("").async("text"))}if((0,r.hasProperty)(t,"graphicsCmdsCompressed")){const s=await(new e).loadAsync(t.graphicsCmdsCompressed,{base64:!0});n.graphicsCmds=i(JSON.parse(await s.file("").async("text")))}return n}return n}},103653:(e,t,s)=>{s.d(t,{seriesPlotFunctionMap:()=>c,barFunction:()=>d,SeriesData:()=>_});var r,n=s(588537),i=s(752280),o=s(377884);!function(e){e[e.FromLeft=-1]="FromLeft",e[e.FromRight=1]="FromRight"}(r||(r={}));const a={open:e=>e[1],high:e=>e[2],low:e=>e[3],close:e=>e[4],hl2:e=>(e[2]+e[3])/2,hlc3:e=>(e[2]+e[3]+e[4])/3,ohlc4:e=>(e[1]+e[2]+e[3]+e[4])/4},h=["open","high","low","close","hl2","hlc3","ohlc4"];function c(){const e=new Map;return h.forEach(((t,s)=>{e.set(t,d(t))})),e}function d(e,t){const s=a[null!=t?t:e],r=a[e];return(e,t)=>0===t?s(e):r(e)}function l(e,t){return null==e[t]}const u=[{barsToMerge:10,forBarspacingLargerThen:.03},{barsToMerge:30,forBarspacingLargerThen:.01},{barsToMerge:100,forBarspacingLargerThen:.003},{barsToMerge:500,forBarspacingLargerThen:0}];class _{constructor(){this._pressedChunks={chunks:new Map,priceSource:"uninitialized"},this.m_bars=new i.PlotList(c(),l),this.m_nsBars=new i.PlotList(c(),l),this._clearPressedChunks()}bars(){return this.m_bars}nsBars(){return this.m_nsBars}pressedChunks(e,t){if(t!==this._pressedChunks.priceSource){this._pressedChunks.priceSource=t;const e=this.m_bars.first();e&&(this._clearPressedChunks(),this._rebuildPressedChunks(e))}const s=(0,n.ensureDefined)(u.find((t=>t.forBarspacingLargerThen<=e)));return(0,n.ensureDefined)(this._pressedChunks.chunks.get(s.barsToMerge))}mergeRegularBars(e){const t=this.m_bars.size(),s=this.m_bars.merge(e);return s&&"uninitialized"!==this._pressedChunks.priceSource&&(t===this.m_bars.size()&&s.index===this.m_bars.lastIndex()?this._updateLatestChunks():this._rebuildPressedChunks(s)),s}size(){return this.m_bars.size()+this.m_nsBars.size()}
each(e){this.m_bars.each(e),this.m_nsBars.each(e)}clear(){this.m_bars.clear(),this.m_nsBars.clear(),this.lastProjectionPrice=void 0,this._clearPressedChunks()}isEmpty(){return this.m_bars.isEmpty()&&this.m_nsBars.isEmpty()}first(){return this.m_bars.isEmpty()?this.m_nsBars.first():this.m_bars.first()}last(){return this.m_nsBars.isEmpty()?this.m_bars.last():this.m_nsBars.last()}search(e,t){return this.nsBars().isEmpty()?this.bars().search(e,t):this.bars().isEmpty()||(0,n.ensureNotNull)(this.nsBars().firstIndex())<=e?this.nsBars().search(e,t):this.bars().search(e,t)}valueAt(e){const t=this.search(e);return null!==t?t.value:null}plotValueToTimePointIndex(e,t,s){if(s===r.FromRight){const s=(s,r)=>{const n=r[t];return null!=n&&e>=n},r=this.m_bars.findLast(s);if(null!==r)return r.index;const n=this.m_nsBars.findLast(s);return null!==n?n.index:this.m_bars.firstIndex()}if(s===r.FromLeft){const s=(s,r)=>{const n=r[t];return null!=n&&e<=n},r=this.m_bars.findFirst(s);if(null!==r)return r.index;const n=this.m_nsBars.findFirst(s);return null!==n?n.index:this.m_bars.lastIndex()}throw new Error("plotValueToTimePointIndex: unsupported search mode")}moveData(e){this.m_bars.move(e),this.m_nsBars.move(e),this.m_bars.size()>0&&this._rebuildPressedChunks((0,n.ensureNotNull)(this.m_bars.first()))}_rebuildPressedChunks(e){const t=this._pressedChunks.priceSource;if("uninitialized"===t)return;const s=e.index,r=a[t],i=(e,t,s)=>{let n=null;for(;e.hasNext();){const i=e.next(),o=r(i.value);n&&i.index-n.startTime>=s.barsToMerge&&(t.push(n),n=null),n?(n.endTime=i.index,n.high=Math.max(n.high,o),n.low=Math.min(n.low,o),n.close=o):n={startTime:i.index,endTime:i.index,open:o,high:o,low:o,close:o}}n&&t.push(n)};u.forEach((e=>{const t=(0,n.ensureDefined)(this._pressedChunks.chunks.get(e.barsToMerge)),r=(0,o.lowerbound)(t,s,((e,t)=>e.endTime<t));if(0===r&&t.length>0){const s=t[0].startTime-1,r=(0,n.ensureNotNull)(this.m_bars.firstIndex()),o=this.m_bars.rangeIterator(r,s),a=[];i(o,a,e);const h=a.concat(t);this._pressedChunks.chunks.set(e.barsToMerge,h)}else{const s=(0,n.ensureNotNull)(this.m_bars.lastIndex());t.splice(r);let o=(0,n.ensureNotNull)(this.m_bars.firstIndex());t.length&&(o=t[t.length-1].endTime+1);const a=this.m_bars.rangeIterator(o,s);i(a,t,e)}}))}_updateLatestChunks(){const e=(0,n.ensureNotNull)(this.m_bars.lastIndex());u.forEach((t=>{const s=(0,n.ensureDefined)(this._pressedChunks.chunks.get(t.barsToMerge)),r=this.m_bars.rangeIterator(e,e).next(),i=r.value[4],o=s[s.length-1];o.high=Math.max(o.high,i),o.low=Math.min(o.low,i),o.close=i,o.endTime=r.index}))}_clearPressedChunks(){u.forEach((e=>this._pressedChunks.chunks.set(e.barsToMerge,[])))}}}}]);