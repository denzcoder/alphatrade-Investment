"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[40968,3657],{294766:(t,e,s)=>{s.d(e,{createTimeToBarTimeAligner:()=>a});s(393987);var i=s(611688),n=(s(273044),s(874200)),r=s(566190);new n.SessionInfo("Etc/UTC","0000-0000:1234567");function o(){return!i.enabled("disable_resolution_rebuild")}function a(t,e){if(!o())return t=>t;const s=new n.SessionInfo(e.timezone,e.session,e.session_holidays,e.corrections),i=(0,r.newBarBuilder)(t,s,s,!1);return t=>i.alignTimeIfPossible(t)}},566190:(t,e,s)=>{s.d(e,{SessionInfo:()=>o.SessionInfo,newBarBuilder:()=>f});var i=s(393987),n=s(273044),r=s(466915),o=s(874200),a=s(370062);class d extends o.BarBuilderBase{constructor(t,e){super(),this._sessionStartMs=-Number.MAX_VALUE,this._sessionEndMs=-Number.MAX_VALUE,this._periodSec=t,this._session=e}alignTimeIfPossible(t){const e=this.alignTime(t);return isNaN(e)?t:e}indexOfBar(t){return t<this._sessionStartMs?a.SessionStage.PRE_SESSION:t>=this._sessionEndMs?a.SessionStage.POST_SESSION:(0,r.toInt)(i.time_seconds_diff(t,this._sessionStartMs)/this._periodSec)}startOfBar(t){if(t===a.SessionStage.PRE_SESSION){const t=i.get_cal_from_unix_timestamp_ms(this._session.timezone,this._sessionStartMs-1),e=this._session.spec.alignToNearestSessionEnd(t,-1);return i.cal_to_utc(this._session.timezone,e)}if(t===a.SessionStage.POST_SESSION)return this._sessionEndMs;if(t<0)throw new Error("Negative offset is not supported");return this._sessionStartMs+i.time_seconds(this._periodSec*t)}endOfBar(t){if(t<0)throw new Error("Index cannot be negative");const e=this.startOfBar(t)+1e3*this._periodSec;return e>this._sessionEndMs?this._sessionEndMs:e}isLastBar(t,e){return e>=this._sessionStartMs+i.time_seconds(this._periodSec*(t+1)-1)}moveTo(t){const e=this._session.timezone,s=i.utc_to_cal(e,t),n=this._session.spec.alignToSessionStart(s);this._sessionStartMs=i.cal_to_utc(e,s),i.add_minutes(s,n),this._sessionEndMs=i.cal_to_utc(e,s)}indexOfLastBarInSession(){return(0,r.toInt)((this._sessionEndMs-1-this._sessionStartMs)/1e3/this._periodSec)}moveNext(){this.moveTo(this._sessionEndMs)}}var u=s(212666);function l(t,e){const s=i.clone(e),n=t.businessDaysToCalendarDays(s,1);n>1&&i.add_date(s,n-1);const r=t.leftBorderOfDailyBar(s);if(null===r)throw new Error("Cannot calculate left border of daily bar");return i.cal_to_utc(i.get_timezone(t.timezone()),r)}class c extends o.BarBuilderBase{constructor(t,e,s,i,n=!1){super(),this._periodStart=-Number.MAX_VALUE,this._periodEnd=-Number.MAX_VALUE,this._periodLastBarStart=-Number.MAX_VALUE,this._periodStartDay=new u.BusinessDay(0,0,0),this._periodEndDay=new u.BusinessDay(0,0,0),this._period=s,this._sessionTgt=t,this._builder=i,this._useBusinessDays=n,this._sessionSrc=n?new o.SessionInfo("Etc/UTC","24x7"):e||t}builder(){return this._builder}alignTimeIfPossible(t){return this.tradingDayToSessionStart(t)}tradingDayToSessionStart(t){return this.moveTo(t),this.startOfBar(0)}indexOfBar(t){if(this._useBusinessDays){const e=u.BusinessDay.fromCalendar(i.get_cal_from_unix_timestamp_ms(this._sessionSrc.timezone,t))
;return e.before(this._periodStartDay)?a.SessionStage.PRE_SESSION:this._periodEndDay.before(e)?a.SessionStage.POST_SESSION:0}return t<this._periodStart?a.SessionStage.PRE_SESSION:t>=this._periodEnd?a.SessionStage.POST_SESSION:0}startOfBar(t){if(t===a.SessionStage.PRE_SESSION){const t=i.get_cal_from_unix_timestamp_ms(this._sessionTgt.timezone,this._periodStart-1),e=this._sessionTgt.spec.alignToNearestSessionEnd(t,-1);return i.cal_to_utc(this._sessionTgt.timezone,e)-1}return t===a.SessionStage.POST_SESSION||t>0?this._periodEnd:t===a.SessionStage.LASTBAR_SESSION?this._periodLastBarStart:this._periodStart}moveTo(t){const e=i.get_cal_from_unix_timestamp_ms(this._sessionSrc.timezone,t);this._sessionSrc.spec.correctTradingDay(e);const s=i.get_year(e),n=this._indexOfPeriodInYear(e),r=n+this._period,o=this._sessionTgt.spec,a=this._sessionTgt.timezone,d=this._builder.startOfPeriod(a,n,s);this._periodStart=l(o,d);const c=i.clone(d),h=o.businessDaysToCalendarDays(c,1);h>1&&i.add_date(c,h-1),this._periodStartDay=u.BusinessDay.fromCalendar(c);const p=this._builder.startOfPeriod(a,r,s);this._periodEnd=l(o,p);const _=i.clone(p);for(i.add_date(_,-1);o.isCalWeekEnd(_);)i.add_date(_,-1);this._periodEndDay=u.BusinessDay.fromCalendar(_),i.add_date(p,-1),function(t,e){for(;t.isCalWeekEnd(e);)i.add_date(e,-1)}(this._sessionTgt.spec,p),this._periodLastBarStart=l(o,p),(this._periodLastBarStart<this._periodStart||this._periodLastBarStart===this._periodEnd)&&(this._periodLastBarStart=this._periodStart)}endOfBar(t){if(0!==t)throw new Error("index should be 0");return this._periodEnd}isLastBar(t,e){if(0!==t)throw new Error("index should be 0");return e>=this._periodLastBarStart}currentRange(){return{from:this._periodStartDay,to:this._periodEndDay}}indexOfBarInYear(t){const e=i.get_cal_from_unix_timestamp_ms(this._sessionSrc.timezone,t),s=i.get_year(e),n=this._builder.indexOfPeriod(e),o=this._sessionTgt.timezone;let a=this._builder.startOfPeriod(o,n,s),d=l(this._sessionTgt.spec,a);return a=i.get_cal_from_unix_timestamp_ms(i.get_timezone("Etc/UTC"),d),s<i.get_year(a)?(a=this._builder.startOfPeriod(o,n-1,s),d=l(this._sessionTgt.spec,a),{index:(n-1)/this._period,time:d}):{index:(0,r.toInt)(n/this._period),time:d}}sessionSrc(){return this._sessionSrc}_indexOfPeriodInYear(t){const e=this._builder.indexOfPeriod(t);let s=(0,r.toInt)(e/this._period)*this._period;return-1===e&&(s=-this._period),s}}function h(t,e){const s=i.get_day_of_week(e)-t.firstDayOfWeek();return s<0?s+7:s}function p(t,e){const s=i.get_day_of_year(e)-1;let n=h(t,e)-s%7;return 0===n?(0,r.toInt)(s/7):(n>=0&&(n-=7),(0,r.toInt)((n+s)/7))}class _{indexOfPeriod(t){return i.get_day_of_year(t)-1}startOfPeriod(t,e,s){const n=i.days_per_year(s);return i.get_cal(i.get_timezone("Etc/UTC"),s,i.JANUARY,1+Math.min(e,n))}}class y extends _{constructor(t){super(),this._sessionsSpec=t}indexOfPeriod(t){return super.indexOfPeriod(t)-function(t,e){const s=p(t,e),n=i.get_cal(i.get_timezone("Etc/UTC"),i.get_year(e),i.JANUARY,1);i.add_date(n,7*s)
;const r=s*t.weekEndsCount()+t.holidaysFromYearStart(n),o=i.get_day_of_year(e)-i.get_day_of_year(n);return r+o-t.calendarDaysToBusinessDays(n,o)}(this._sessionsSpec,t)}startOfPeriod(t,e,s){const n=7-this._sessionsSpec.weekEndsCount(),o=Math.max(0,(0,r.toInt)(e/n)-1),a=i.get_cal(i.get_timezone("Etc/UTC"),s,i.JANUARY,1),d=i.get_days_per_year(a);if(i.add_date(a,7*o),(e-=n*o-this._sessionsSpec.holidaysFromYearStart(a))>0){const t=this._sessionsSpec.businessDaysToCalendarDays(a,e);i.add_date(a,t)}let u=i.get_day_of_year(a)-1;return s<i.get_year(a)&&(u+=d),super.startOfPeriod(t,u,s)}}class S{constructor(t){this._builder=null,this._initialized=!1,this._session=t}indexOfPeriod(t){return this._getBuilder().indexOfPeriod(t)}startOfPeriod(t,e,s){return this._getBuilder().startOfPeriod(t,e,s)}_getBuilder(){return null!==this._builder&&this._initialized||(this._builder=this._session.spec.hasWeekEnds()?new y(this._session.spec):new _,this._initialized=!0),this._builder}}class m{constructor(t){this._session=t}indexOfPeriod(t){let e=p(this._session.spec,t);if(0===e){const s=i.get_timezone(this._session.spec.timezone());t<this.startOfPeriod(s,0,i.get_year(t))&&(e=-1)}return e}startOfPeriod(t,e,s){if(e<0){s--;const n=i.get_cal(i.get_timezone("Etc/UTC"),s,i.DECEMBER,31,23,59,59),o=this.indexOfPeriod(n),a=-1*e,d=(0,r.toInt)(o/a)*a;return this.startOfPeriod(t,d,s)}const n=i.get_cal(i.get_timezone("Etc/UTC"),s,i.JANUARY,1),o=h(this._session.spec,n),a=0===o?7*e:7*(e+1)-o;return a>i.get_days_per_year(n)?this.startOfPeriod(t,0,s+1):(i.add_date(n,a),n)}}class g{indexOfPeriod(t){return i.get_month(t)}startOfPeriod(t,e,s){if(e<0){const t=(0,r.toInt)((11-e)/12);s-=t,e+=12*t}else e>i.DECEMBER&&(s++,e=i.JANUARY);return i.get_cal(i.get_timezone("Etc/UTC"),s,e,1)}}function f(t,e,s,i=!1){const r=n.Interval.parse(t),o=r.multiplier();return r.isMinutes()?new d(60*o,e):r.isSeconds()?new d(o,e):r.isTicks()?new d(1,e):r.isRange()?new d(60*o,e):new c(e,s,o,function(t,e){switch(t){case n.ResolutionKind.Days:return new S(e);case n.ResolutionKind.Weeks:return new m(e);case n.ResolutionKind.Months:return new g}throw new Error(`Unknown dwm resolution: ${t}`)}(r.kind(),e),i)}},540968:(t,e,s)=>{s.r(e),s.d(e,{cloneLineTool:()=>se,createLineTool:()=>Ht,createLineToolProperties:()=>qt,createStudyLineToolProperties:()=>Jt,getNewToolProperties:()=>Yt,isLineDrawnWithPressedButton:()=>Ut.isLineDrawnWithPressedButton,isLineTool:()=>Qt,isLineToolName:()=>Ut.isLineToolName,isStudyLineTool:()=>Zt,isStudyLineToolName:()=>Ut.isStudyLineToolName,isTrading:()=>te,lineToolByLinkKey:()=>ie,prepareLineToolPropertiesByOwnerSource:()=>Xt,setNewToolProperties:()=>Gt,supportsPhantomMode:()=>Kt,tryFindStudyLineToolNameByStudyId:()=>ee,unsetNewToolProperties:()=>jt});var i={};s.r(i),s.d(i,{LineStudyMtpAnalysis:()=>st,LineStudyMtpDecisionPoint:()=>nt,LineStudyMtpDownWave1OrA:()=>St,LineStudyMtpDownWave2OrB:()=>gt,LineStudyMtpDownWave3:()=>Pt,LineStudyMtpDownWave4:()=>wt,LineStudyMtpDownWave5:()=>Tt,LineStudyMtpDownWaveC:()=>vt,LineStudyMtpElliotWaveMain:()=>ut,
LineStudyMtpElliotWaveMajor:()=>ct,LineStudyMtpElliotWaveMinor:()=>pt,LineStudyMtpRiskReward:()=>ot,LineStudyMtpUpWave1OrA:()=>Dt,LineStudyMtpUpWave2OrB:()=>Vt,LineStudyMtpUpWave3:()=>Mt,LineStudyMtpUpWave4:()=>Ft,LineStudyMtpUpWave5:()=>Bt,LineStudyMtpUpWaveC:()=>Rt});var n=s(588537),r=s(86441),o=s(417791),a=s(529491),d=s(103573),u=s.t(d,2),l=s(676745),c=s(244276),h=s(970028),p=s(491791),_=s(424146),y=s(270617),S=s(346090);const m=(0,c.studyIdString)("RegressionTrend","tv-basicstudies");function g(t){return void 0!==t.startPrice&&void 0!==t.endPrice}function f(t,e,s,i){return e.styles&&(P(e.styles.baseLine),P(e.styles.downLine),P(e.styles.upLine)),e}function P(t){void 0!==t&&void 0!==t.visible&&(t.display=t.visible?15:0,delete t.visible)}class I extends o.StudyLineDataSource{constructor(t,e,i,r,o){i=null!=i?i:(0,n.ensureNotNull)(t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:m}));super(t,i,"linreg_",null!=e?e:I.createProperties(t),r,o),this.version=2,this._trendData=null,Promise.all([s.e(93987),s.e(44572),s.e(51583)]).then(s.bind(s,691338)).then((t=>{this._setPaneViews([new t.RegressionTrendPaneView(this,this._model)])}))}formatter(){throw new Error("This method should never be called")}pointsCount(){return 2}clearData(){this._trendData=null,super.clearData()}state(t){var e;const s=super.state(t);return t?{...s,nonseriesdata:null!==(e=this._trendData)&&void 0!==e?e:void 0}:s}restoreData(t){var e;super.restoreData(t),this._trendData=null!==(e=t.nonseriesdata)&&void 0!==e?e:null}startIndex(){if(null===this._trendData||null===this._indexes)return null;const t=this._indexes[this._trendData.startIndex];return t!==l.INVALID_TIME_POINT_INDEX?t:null}endIndex(){if(null===this._trendData||null===this._indexes)return null;const t=this._indexes[this._trendData.endIndex];return t!==l.INVALID_TIME_POINT_INDEX?t:null}baseLine(){return null===this._trendData?null:this._trendData.baseLine}downLine(){return null===this._trendData?null:this._trendData.downLine}upLine(){return null===this._trendData?null:this._trendData.upLine}pearsons(){return null===this._trendData?null:this._trendData.pearsons}recalcStudyIfNeeded(){this._onStudyInputsMayChange()}cloneable(){return!1}static createProperties(t,e){const s=h.StudyMetaInfo.getStudyPropertyRootNameById(m),i=(0,n.ensureNotNull)(t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:m})),r=(0,S.createDefaultsState)(!0,s,[],t.studyVersioning());return this.createRegressionTrendPropertiesFromStudyMetaInfoAndState(i,i,(0,y.merge)((0,y.clone)(r),null!=e?e:{}),t.studyVersioning())}static createRegressionTrendPropertiesFromStudyMetaInfoAndState(t,e,s,i){const n=(0,p.prepareStudyPropertiesForLoadChart)(t,e,s,null,i,f);return this._configureProperties(n),n}static studyId(){return m}_studyInputs(t){(0,n.assert)(2===t.length,"all the line tool points should be defined");const[e,s]=t;if(e.index===s.index)return null;const i=this._getPointTime(e.index<=s.index?e:s,!0),r=this._getPointTime(s.index>=e.index?s:e,!0)
;return null===i||null===r?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),"first bar time":1e3*i,"last bar time":1e3*r}}_onDataUpdated(t,e,s){null!==e&&(e.indexes_replace||(this._trendData=e.data),"nochange"!==s&&(this._indexes=s),super._onDataUpdated(t,e,s))}_isReady(){return null!==this._trendData&&void 0!==this._trendData.startIndex&&void 0!==this._trendData.endIndex&&g(this._trendData.upLine)&&g(this._trendData.baseLine)&&g(this._trendData.downLine)}_updateAnchorsPrice(){if(!this._trendData||(0,y.isNaN)(this._trendData.baseLine.startPrice)||(0,y.isNaN)(this._trendData.baseLine.endPrice))return;const{startPrice:t,endPrice:e}=this._trendData.baseLine;2===this._points.length&&(this._points[0].price=(0,n.ensureDefined)(t),this._points[1].price=(0,n.ensureDefined)(e),this._timePoint[0].price=(0,n.ensureDefined)(t),this._timePoint[1].price=(0,n.ensureDefined)(e))}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([s.e(39509),s.e(64320),s.e(39261),s.e(60607)]).then(s.bind(s,340647))).RegressionTrendDefinitionsViewModel}static _configureProperties(t){super._configureProperties(t);const e=t.childs().styles.childs(),s=[e.upLine.childs().linewidth,e.downLine.childs().linewidth,e.baseLine.childs().linewidth];t.addChild("linesWidths",new _.LineToolWidthsProperty(s))}}var w=s(667791);const b=(0,c.studyIdString)("VbPFixed","tv-basicstudies");class T extends w.LineToolVbPFixed{constructor(t,e,s,i,n,r){const o=s||t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:b});super(t,e,o,i,n,r)}calcIsActualSymbol(){o.StudyLineDataSource.prototype.calcIsActualSymbol.apply(this)}boundToSymbol(){return!0}isSynchronizable(){return this.priceScale()===this._model.mainSeries().priceScale()}static studyId(){return b}static createProperties(t,e){const s=h.StudyMetaInfo.getStudyPropertyRootNameById(b),i=(0,n.ensureNotNull)(t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:b})),r=(0,S.createDefaultsState)(!0,s,[],t.studyVersioning());return this.createPropertiesFromStudyMetaInfoAndState(i,i,(0,y.merge)((0,y.clone)(r),null!=e?e:{}),t.studyVersioning())}static createPropertiesFromStudyMetaInfoAndState(t,e,s,i){const n=(0,p.prepareStudyPropertiesForLoadChart)(t,e,s,null,i);return this._configureProperties(n),n}}var C=s(262325),v=s.n(C),A=s(611688),D=s(344265),x=s(362145),V=s(349692),L=s(232567),M=s.n(L),E=s(559270),F=s(752280),N=s(498424);class B extends N.PriceAxisView{constructor(t){super(),this._model=t.model(),this._source=t}_updateRendererData(t,e,s){t.visible=!1,e.visible=!1;const i=this._source.model(),n=this._source.priceScale();if(null===n)return;if(!i.isPriceScaleVisible(n))return;const r=this._source.lastValueData("",!1);r.noData||(s.background=r.color,s.textColor=this.generateTextColor(r.color),s.coordinate=r.coordinate,s.floatCoordinate=r.floatCoordinate,this._showAxisLabel()&&(t.text=r.text,t.visible=!0))}_showAxisLabel(){return this._source.properties().childs().axisLabelVisible.value()}}var O=s(127641),R=s(104458),U=s(707127)
;class W extends R.StudyPlotPaneView{constructor(t,e,s,i){super(t,e,s,i),this._line=t}_updateImplFull(){if(super._updateImplFull(!0),window.TradingView.printing||!this._line.hasAlert.value()||this._model.readOnly()||this._model.isInReplay())return!1;const t=this._items;if(!this._renderer.isEmpty()&&t.length>0){const e=t[t.length-1],s=this._model.timeScale().width();if(e.x<0||t[0].x>s)return!1;const i=Math.min(s-5,e.x);let n=e.y;if(e.x>i){let s=t.length-2;for(;s>=0;){const r=t[s];if(r.x<=i){const t=(i-r.x)/(e.x-r.x);n=r.y+(e.y-r.y)*t;break}s-=1}}const o=new r.Point(i,n);return this._renderer.append(new U.PaneRendererClockIcon({points:[o],color:this._line.getAlertIsActive()?this._lineColor:O.Constants.DrawingIconColor,horzMargin:-16})),!0}return!1}_updateImplLight(){this._updateImplFull()}}var k=s(911905),z=s(496396),$=s(51975),G=s(694755),j=s(194459);const Y=(0,k.getLogger)("Chart.AnchoredVWAP"),H=(0,c.studyIdString)("AnchoredVWAP","tv-basicstudies");function X(t,e,s,i){return"calculate_stDev"in(0,n.ensureDefined)(t.inputs)||void 0===i.inputs.find((t=>"calculate_stDev"===t.id))||((0,n.ensureDefined)(e.inputs).calculate_stDev=!1),e.styles&&(q(e.styles.VWAP),q(e.styles.UpperBand),q(e.styles.LowerBand),q(e.styles.UpperBand_2),q(e.styles.LowerBand_2),q(e.styles.UpperBand_3),q(e.styles.LowerBand_3)),e}function q(t){void 0!==t&&void 0!==t.visible&&(t.display=t.visible?15:0,delete t.visible)}class J extends o.StudyLineDataSource{constructor(t,e,s,i,r){s=s||(0,n.ensureNotNull)(t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:H}));const o=null!=e?e:J.createProperties(t);super(t,s,"anchoredvwap",o,i,r);const[a,d,u,l,c,h,p]=this.metaInfo().plots,_=t.mainSeries(),y=[new W(this,_,t,a.id)];d&&u&&(y.push(new R.StudyPlotPaneView(this,_,t,d.id)),y.push(new R.StudyPlotPaneView(this,_,t,u.id))),l&&c&&h&&p&&(y.push(new R.StudyPlotPaneView(this,_,t,l.id)),y.push(new R.StudyPlotPaneView(this,_,t,c.id)),y.push(new R.StudyPlotPaneView(this,_,t,h.id)),y.push(new R.StudyPlotPaneView(this,_,t,p.id))),this._properties.childs().areaBackground&&y.splice(0,0,new $.AreaBackgroundPaneView(this,t)),this._lastValuePriceAxisView=new B(this),this._anchorPriceCalculated=!1,this._onInputsReadyCallbacks=[],this._setPaneViews(y),t.properties().childs().scalesProperties.childs().showStudyLastValue.subscribe(this,this._onShowStudyLastValueChanged),o.onRestoreFactoryDefaults().subscribe(this,this._onRestoreFactoryDefaults)}destroy(){this.properties().onRestoreFactoryDefaults().unsubscribeAll(this),this.model().properties().childs().scalesProperties.childs().showStudyLastValue.unsubscribeAll(this),this._onInputsReadyCallbacks=[],super.destroy()}canHasAlert(){return!0}pointsCount(){return 1}priceAxisViews(t,e){if(e!==this.priceScale()||this.isSourceHidden())return null;const s=super.priceAxisViews(t,e);return null===s?[this._lastValuePriceAxisView]:[...s,this._lastValuePriceAxisView]}updateAllViews(t){super.updateAllViews(t),this._lastValuePriceAxisView.update(t)}offset(t){return 0}firstValue(){return this._model.mainSeries().firstValue()}
getMinFirstBarIndexForPlot(){return-1/0}priceRange(t,e){if(!this._isReady()||this.isSourceHidden())return null;const s=this.plots().minMaxOnRangeCached(t,e,[{name:this.metaInfo().plots[0].id,offset:0}]);if(null===s)return null;const i=(0,n.ensureNotNull)(this.priceScale());return i.isLog()?new E.PriceRange(i.priceToLogical(s.min),i.priceToLogical(s.max)):new E.PriceRange(s.min,s.max)}isIncludedInAutoScale(){return!0}lastValueData(t,e,s){const i={noData:!0},r=this.priceScale();if(this._model.timeScale().isEmpty()||null===this.priceScale()||null===r||r.isEmpty()||this.plots().isEmpty())return i;const o=this._model.timeScale().visibleBarsStrictRange();if(null===o)return i;if(!this.properties().childs().visible.value())return i;const a=this.plots().search(o.lastBar(),F.PlotRowSearchMode.NearestLeft,1);if(null===a)return i;const d=o.contains(a.index),u=!e&&d?a:(0,n.ensureNotNull)(this.plots().last());if(!u||!(0,y.isNumber)(u.value[1]))return i;const l=u.value[1],c=this.properties().childs().styles.childs().VWAP,h=(0,n.ensureNotNull)(this.firstValue()),p=r.priceToCoordinate(l,h);return{...r.getFormattedValues(l,h),noData:!1,price:l,color:c.childs().color.value(),coordinate:p,floatCoordinate:p,index:u.index}}restoreData(t){super.restoreData(t),void 0!==t.data&&(this._anchorPriceCalculated=!0)}properties(){return super.properties()}sourceId(){return this._studyId()}hasStateForAlert(){return A.enabled("alerts")&&null!==this._inputs}alertCreationAvailable(){return new(v())(!this.hasAlert.value()&&this.hasStateForAlert()).readonly()}stateForAlert(){const t=this.metaInfo(),e=(0,V.plotsForAlert)(t,this.offset.bind(this),["VWAP"]),s=(0,V.collectDepsForAlert)([this],this.id()),i=s.idForAlert,n=s.studyDependencies,r=s.inputsForAlert,o=(this.priceScale()||this.model().mainSeries().priceScale()).formatter(),a=o?x.FormattersSerializer.serialize(o):null;return{id:i,uniqueId:i,type:z.StateForAlertType.StudyLineTool,title:(0,G.clean)(this.translatedType(),!0),shortTitle:(0,G.clean)(this.translatedType(),!0),shortDescription:(0,G.clean)(t.shortDescription||"Study",!0),interval:this._model.mainSeries().interval(),fullId:t.fullId,isTVScript:Boolean(t.isTVScript),isTVScriptStrategy:Boolean(t.isTVScriptStrategy),isTVLibrary:Boolean(t.isTVLibrary),hasAlertFunction:Boolean(t.hasAlertFunction),plots:e,inputs:r,alerts:t.alerts,scriptIdPart:t.scriptIdPart,scriptVersion:t.pine?t.pine.version:"-1",callStudyDependencies:(0,D.formatCallstudyArg)((0,V.dependenciesForAlerts)([],this._model.studyMetaInfoRepository())),studyDependencies:n,formatter:a}}inputsForAlertState(){null===this._inputs&&Y.logError("Could not get inputsForAlertState if VWAP has no inputs");const{start_time:t,source:e}=this.inputs();return{start_time:t,source:e}}inputs(){return(0,n.ensureNotNull)(this._inputs)}idForAlert(){return(0,V.collectDepsForAlert)([this],this.id()).idForAlert}defaultPlotIdForAlert(){return this.metaInfo().plots[0].id}isPlotVisibleAt(t,e){return(this.properties().childs().styles.childs()[t].childs().display.value()&e)===e}static createProperties(t,e){
const s=h.StudyMetaInfo.getStudyPropertyRootNameById(H),i=(0,n.ensureNotNull)(t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:H})),r=(0,S.createDefaultsState)(!0,s,[],t.studyVersioning());return this.createPropertiesFromStudyMetaInfoAndState(i,i,(0,y.merge)((0,y.clone)(r),null!=e?e:{}),t.studyVersioning())}static studyId(){return H}static createPropertiesFromStudyMetaInfoAndState(t,e,s,i){const n=(0,p.prepareStudyPropertiesForLoadChart)(t,e,s,null,i,X);return this._configureProperties(n),n}_onPointsetUpdated(t){super._onPointsetUpdated(t),this._onStudyInputsMayChange()}_studyInputs(t){(0,n.assert)(1===t.length,"all the line tool points should be defined");const e=t[0],s=this._getPointTime(e,!1);return null===s?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(["start_time"]),start_time:1e3*s}}_isReady(){return super._isReady()&&(null!==this._inputs||this._anchorPriceCalculated)&&this.model().lineBeingEdited()!==this}_onDataCleared(){super._onDataCleared(),this._anchorPriceCalculated=!1}_onInputsChanged(){if(super._onInputsChanged(),null!==this._inputs){for(const t of this._onInputsReadyCallbacks)try{t(this._inputs)}catch(t){Y.logError(t.stack||t.message)}this._onInputsReadyCallbacks=[]}}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([s.e(39509),s.e(39261),s.e(18537)]).then(s.bind(s,873109))).AnchoredVWAPDefinitionsViewModel}_updateAnchorsPrice(t){if(!t&&(this._anchorPriceCalculated||!this.isActualSymbol()))return;const e=this.firstValue(),s=this.points();if(null===e||0===s.length)return;const i=s[0].index,n=this.plots().valueAt(i);if(null===n)return;const r=n[1];null!=r&&(this._points[0].price=r,this._timePoint[0].price=r,this._anchorPriceCalculated=!0)}_synchronizeAlert(t){this._onInputsReady((()=>super._synchronizeAlert(t)))}static _configureProperties(t){super._configureProperties(t),t.hasChild("axisLabelVisible")||t.addChild("axisLabelVisible",new(M())(true));const e=t.childs().styles.childs().VWAP.childs().linewidth,s=t.childs().styles.childs().VWAP.childs().color;t.addChild("linesWidths",new _.LineToolWidthsProperty([e])),t.addChild("linesColors",new _.LineToolColorsProperty([s]))}_onInputsReady(t){null!==this._inputs?t(this._inputs):this._onInputsReadyCallbacks.push(t)}_onShowStudyLastValueChanged(){this._lastValuePriceAxisView.update((0,j.sourceChangeEvent)(this.id())),this.model().updateSource(this)}_onRestoreFactoryDefaults(){this.properties().childs().axisLabelVisible.setValue(true)}}var K=s(721925),Q=s(591419);function Z(t){return(0,c.studyIdString)(t,"mtp-mtpredictor")}class tt extends o.StudyLineDataSource{constructor(t,e,s,i,n,r){const o=Z(i),a=s||t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:o}),d=e||tt._createPropertiesFromStudyMetaInfo(a,t.studyVersioning());super(t,a,i,d,n,r),this._formatter=new Q.VolumeFormatter,(0,K.createGraphicsPaneViews)(this,t).then(this._setPaneViews.bind(this))}formatter(){return this._formatter}static _createPropertiesFromMtpStudyShortIdAndState(t,e){
return super._createPropertiesFromStudyIdAndState(Z(t),e)}static _createPropertiesFromStudyMetaInfo(t,e){const s=(0,p.prepareStudyProperties)(t,null,null,e);return super._configureProperties(s),s}}const et="mtp_tsanalysis";class st extends tt{constructor(t,e,s,i,n){super(t,e,s,et,i,n)}pointsCount(){return 1}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(et,t)}static studyId(){return Z(et)}_studyInputs(t){(0,n.assert)(1===t.length,"all the line tool points should be defined");const e=this._getPointTime(t[0],!0);return null===e?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),bar:1e3*e}}}const it="mtp_decisionpoint";class nt extends tt{constructor(t,e,s,i,n){super(t,e,s,it,i,n),this._symbolIntervalChanged=!1,this._model.mainSeries().onSymbolIntervalChanged().subscribe(this,this._onSymbolIntervalChanged)}destroy(){this._model.mainSeries().onSymbolIntervalChanged().unsubscribeAll(this),super.destroy()}pointsCount(){return 1}onData(t){super.onData(t),this._symbolIntervalChanged=!1}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(it,t)}static studyId(){return Z(it)}_studyInputs(t){(0,n.assert)(1===t.length,"all the line tool points should be defined");const e=this._getPointTime(t[0],!0);return null===e?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),symbolIntervalChanged:this._symbolIntervalChanged,bar:1e3*e}}_onSymbolIntervalChanged(){this._symbolIntervalChanged=!0}}const rt="mtp_riskreward";class ot extends tt{constructor(t,e,s,i,n){super(t,e,s,rt,i,n)}pointsCount(){return 3}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(rt,t)}static getTooltipText(t){return t&&0!==t._points.length?1===t._points.length?"Select Stop Bar":2===t._points.length?"Select Target Point":null:"Select Entry Setup Bar"}static studyId(){return Z(rt)}_studyInputs(t){(0,n.assert)(3===t.length,"all the line tool points should be defined");const e=this._getPointTime(t[0],!0),s=this._getPointTime(t[1],!0),i=this._getPointTime(t[2],!0);return null===e||null===s||null===i?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),entry_bar:1e3*e,stop_bar:1e3*s,target_bar:1e3*i,target_price:t[2].price}}}class at extends tt{pointsCount(){return 1}_studyInputs(t){(0,n.assert)(1===t.length,"all the line tool points should be defined");const e=this._getPointTime(t[0],!0);return null===e?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),bar:1e3*e}}}const dt="mtp_ew_main";class ut extends at{constructor(t,e,s,i,n){super(t,e,s,dt,i,n)}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(dt,t)}static studyId(){return Z(dt)}}const lt="mtp_ew_major";class ct extends at{constructor(t,e,s,i,n){super(t,e,s,lt,i,n)}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(lt,t)}static studyId(){return Z(lt)}}
const ht="mtp_ew_minor";class pt extends at{constructor(t,e,s,i,n){super(t,e,s,ht,i,n)}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(ht,t)}static studyId(){return Z(ht)}}class _t extends tt{_studyInputs(t){(0,n.assert)(t.length===this.pointsCount(),"all the line tool points should be defined");const e={...this.properties().childs().inputs.state()};for(let s=0;s<this.pointsCount();++s){const i=this._getPointTime(t[s],!0);if(null===i)return this._subscribeApplyInputsOnSeriesCompleted(),null;e[`bar${s}`]=1e3*i}return e}}const yt="mtp_wpt_down1ora";class St extends _t{constructor(t,e,s,i,n){super(t,e,s,yt,i,n)}pointsCount(){return 2}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(yt,t)}static getTooltipText(t){return`Down Wave 1 or A: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return Z(yt)}}const mt="mtp_wpt_down2orb";class gt extends _t{constructor(t,e,s,i,n){super(t,e,s,mt,i,n)}pointsCount(){return 2}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(mt,t)}static getTooltipText(t){return`Down Wave 2 or B: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return Z(mt)}}const ft="mtp_wpt_down3";class Pt extends _t{constructor(t,e,s,i,n){super(t,e,s,ft,i,n)}pointsCount(){return 3}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(ft,t)}static getTooltipText(t){return`Down Wave 3: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return Z(ft)}}const It="mtp_wpt_down4";class wt extends _t{constructor(t,e,s,i,n){super(t,e,s,It,i,n)}pointsCount(){return 2}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(It,t)}static getTooltipText(t){return`Down Wave 4: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return Z(It)}}const bt="mtp_wpt_down5";class Tt extends _t{constructor(t,e,s,i,n){super(t,e,s,bt,i,n)}pointsCount(){return 5}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(bt,t)}static getTooltipText(t){return`Down Wave 5: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return Z(bt)}}const Ct="mtp_wpt_downc";class vt extends _t{constructor(t,e,s,i,n){super(t,e,s,Ct,i,n)}pointsCount(){return 3}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(Ct,t)}static getTooltipText(t){return`Down Wave C: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return Z(Ct)}}const At="mtp_wpt_up1ora";class Dt extends _t{constructor(t,e,s,i,n){super(t,e,s,At,i,n)}pointsCount(){return 2}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(At,t)}static getTooltipText(t){return`Up Wave 1 or A: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return Z(At)}}const xt="mtp_wpt_up2orb";class Vt extends _t{constructor(t,e,s,i,n){super(t,e,s,xt,i,n)}pointsCount(){return 2}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(xt,t)}static getTooltipText(t){
return`Up Wave 2 or B: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return Z(xt)}}const Lt="mtp_wpt_up3";class Mt extends _t{constructor(t,e,s,i,n){super(t,e,s,Lt,i,n)}pointsCount(){return 3}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(Lt,t)}static getTooltipText(t){return`Up Wave 3: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return Z(Lt)}}const Et="mtp_wpt_up4";class Ft extends _t{constructor(t,e,s,i,n){super(t,e,s,Et,i,n)}pointsCount(){return 2}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(Et,t)}static getTooltipText(t){return`Up Wave 4: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return Z(Et)}}const Nt="mtp_wpt_up5";class Bt extends _t{constructor(t,e,s,i,n){super(t,e,s,Nt,i,n)}pointsCount(){return 5}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(Nt,t)}static getTooltipText(t){return`Up Wave 5: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return Z(Nt)}}const Ot="mtp_wpt_upc";class Rt extends _t{constructor(t,e,s,i,n){super(t,e,s,Ot,i,n)}pointsCount(){return 3}static createProperties(t){return super._createPropertiesFromMtpStudyShortIdAndState(Ot,t)}static getTooltipText(t){return`Up Wave C: Select Point ${(t?t._points.length:0)+1}`}static studyId(){return Z(Ot)}}var Ut=s(29084),Wt=s(157759),kt=s(669415);function zt(t){for(const e of Object.keys(t))TradingView[e]=t[e]}zt(u),zt({LineToolRegressionTrend:I,LineToolVbPFixed:w.LineToolVbPFixed,LineToolFixedRangeVolumeProfile:T}),zt({LineToolAnchoredVWAP:J}),zt(i);let $t=null;function Gt(t,e,s){return null!==$t&&$t.tool===t&&$t.toolData===e||($t={properties:qt(t,void 0,s),tool:t,toolData:e}),$t.properties}function jt(){$t=null}function Yt(t){return null!==$t&&$t.tool===t?$t.properties:null}function Ht(t,e,s,r,o,a){let d;if((0,n.assert)((0,Ut.isLineToolName)(t),"Unknown line tool: "+t),o||s||(s=Yt(t)||void 0),"LineToolVbPFixed"===t)d=new w.LineToolVbPFixed(e,s,(0,n.ensureDefined)(r),e.mainSeries(),o,a);else if("LineToolFixedRangeVolumeProfile"===t)d=new T(e,s,(0,n.ensureDefined)(r),e.mainSeries(),o,a);else if("LineToolRegressionTrend"===t)d=new I(e,s,(0,n.ensureDefined)(r),o,a);else if("LineToolAnchoredVWAP"===t)d=new J(e,s,(0,n.ensureDefined)(r),o,a);else if(t in i){d=new((0,n.ensureDefined)(i[t]))(e,s,(0,n.ensureDefined)(r),o,a)}else{d=new((0,n.ensureDefined)(u[t]))(e,s,o,a)}return d.toolname=t,jt(),d}function Xt(t,e){const s=(0,n.ensureNotNull)(e.symbolSource());t.childs().symbol.setValue(s.symbol()),s.model().currencyConversionEnabled()&&t.childs().currencyId.setValue(s.currency()),s.model().unitConversionEnabled()&&t.childs().unitId.setValue(s.unit()),t.childs().symbolStateVersion.setValue(2),t.childs().zOrderVersion.setValue(2)}function qt(t,e,s){if((0,n.assert)((0,Ut.isLineToolName)(t),`${t} should be name of the line tool`),"LineToolVbPFixed"===t)return w.LineToolVbPFixed.createProperties(s,e);if("LineToolFixedRangeVolumeProfile"===t)return T.createProperties(s,e)
;if("LineToolRegressionTrend"===t)return I.createProperties(s,e);if("LineToolAnchoredVWAP"===t)return J.createProperties(s,e);if(t in i){return(0,n.ensureDefined)(i[t]).createProperties(e)}return(0,n.ensureDefined)(u[t]).createProperties(e)}function Jt(t,e,s,r,o){if((0,n.assert)((0,Ut.isStudyLineToolName)(t),`${t} should be name of the study line tool`),"LineToolVbPFixed"===t)return w.LineToolVbPFixed.createPropertiesFromStudyMetaInfoAndState(e,s,r,o);if("LineToolFixedRangeVolumeProfile"===t)return T.createPropertiesFromStudyMetaInfoAndState(e,s,r,o);if("LineToolRegressionTrend"===t)return I.createRegressionTrendPropertiesFromStudyMetaInfoAndState(e,s,r,o);if("LineToolAnchoredVWAP"===t)return J.createPropertiesFromStudyMetaInfoAndState(e,s,r,o);if(t in i){return(0,n.ensureDefined)(i[t]).createPropertiesFromStudyMetaInfoAndState(e,s,r,o)}throw new Error(`Property creation is not implemented for study line tool ${t}`)}function Kt(t){(0,n.assert)((0,Ut.isLineToolName)(t),`${t} should be name of the line tool`);const e=u[t];return void 0!==e&&Boolean(e.supportPhantomMode)}function Qt(t){return t instanceof a.LineDataSource}function Zt(t){return t instanceof o.StudyLineDataSource}function te(t){return t instanceof Wt.LineToolTrading}function ee(t){let e=null;if(t===I.studyId()?e="LineToolRegressionTrend":t===w.LineToolVbPFixed.studyId()?e="LineToolVbPFixed":t===T.studyId()&&(e="LineToolFixedRangeVolumeProfile"),null===e)for(const e in i)if(i[e].studyId()===t)return e;return e}function se(t,e,s,i){const o=e.toolname,a=e.properties().state();a.intervalsVisibilities=(0,kt.mergeIntervalVisibilitiesDefaults)(null==a?void 0:a.intervalsVisibilities);const d=qt(e.toolname,a,t);d.childs().visible.setValue(!0);const u=(0,n.ensureNotNull)(e.ownerSource()),l=Ht(o,t,d);void 0!==i&&l.setId(i),l.setOwnerSource(u),l.toolname=o;const c=l.clonePositionOffset(),h=e.fixedPoints();(s?h.map((t=>t.add(new r.Point(c.xCoordOffset,c.yCoordOffset)))):h).forEach((t=>l.addFixedPoint(t)));const p=e.normalizedPoints(),_=s?function(t,e,s){const i=(0,n.ensureNotNull)(e.priceScale()),r=(0,n.ensureNotNull)(e.firstValue());return t.map((t=>{const e=t.price,n=i.priceToCoordinate(e,r)+s.yCoordOffset,o=i.coordinateToPrice(n,r);return{time_t:t.time_t,price:o,offset:t.offset+s.barOffset}}))}(p,u,c):p,y=e.points();return l.restorePoints(_,y),l.cloneData&&l.cloneData(e),l.recalculateStateByData&&l.recalculateStateByData(),l}function ie(t,e){var s;return null!==(s=t.dataSources().find((t=>Qt(t)&&t.linkKey().value()===e)))&&void 0!==s?s:null}},417791:(t,e,s)=>{s.d(e,{StudyLineDataSource:()=>T});var i=s(588537),n=s(270617),r=s(752280),o=s(529491),a=s(346090),d=s(970028),u=s(721925),l=s(624635),c=s(12270),h=s(183939),p=s(523083),_=s(491791),y=s(393987),S=s(294766),m=s(194459),g=s(906096),f=s(5073);class P extends f.StatusProviderBase{constructor(t){super(t.model().properties().childs().scalesProperties.childs().textColor),this._source=t}color(){return"#ff0000"}errorStatus(){const t=this._source.status();return t.type===g.StudyStatusType.Error?{
error:this.sourceStatusText(),solutionId:(0,g.studyStatusSolutionId)(t),title:(0,g.studyStatusTitle)(t),studyFeature:(0,g.studyStatusFeature)(t)}:null}getSplitTitle(){return this._source.titleInParts()}text(){return this._source.translatedType()}sourceStatusText(){return(0,g.convertStudyStatusToString)(this._source.status(),!0)}}var I=s(388230),w=s(892139);class b extends w.StatusView{constructor(t){super(t.statusProvider({}))}getSplitTitle(){return this._statusProvider.getSplitTitle()}}class T extends o.LineDataSource{constructor(t,e,i,n,r,o){super(t,n,r,o),this._indexes=null,this._inputs=null,this._definitionsViewModel=null,this._pointsetPoints=null,this._loadedPlots=null,this._loadedGraphics=null,this._beingCreatedPaneView=null,this._anchorsPaneView=null,this._isLegendDisplayed=!1,this._alignerCache=null,Promise.all([Promise.all([s.e(93987),s.e(44572),s.e(51583)]).then(s.bind(s,336644)),Promise.all([s.e(93987),s.e(44572),s.e(51583)]).then(s.bind(s,301550))]).then((e=>{const{LineToolBeingCreatedPaneView:s}=e[0],{StudyLineDataSourceAnchorsPaneView:i}=e[1];this._beingCreatedPaneView=new s(this,t),this._anchorsPaneView=new i(this,this.model()),this._model.lightUpdate()})),this._metaInfo=e,this._dataSource=new c.StudyDataSource(t.chartApi(),t.mainSeries().seriesSource(),i,e),this._dataSource.dataCleared().subscribe(this,this._onDataCleared),this._dataSource.dataUpdated().subscribe(this,this._onDataUpdated),this._dataSource.studyStatusChanged().subscribe(this,this._onStudyStatusChanged),this._statusProvider=new P(this),this._statusView=new b(this),this._showStudyArgumentsProperty=t.properties().childs().paneProperties.childs().legendProperties.childs().showStudyArguments}isDisplayedInLegend(){return this._isLegendDisplayed}titleInParts(){const t=[];if(this._showStudyArgumentsProperty.value()&&this._inputs)for(const e of this._metaInfo.inputs){if(!0===e.isHidden||"bool"===e.type)continue;const s=this._inputs[e.id];t.push(s.toString())}return[this.name(),t]}destroy(){this._dataSource.dataUpdated().unsubscribeAll(this),this._dataSource.dataCleared().unsubscribeAll(this),this._dataSource.studyStatusChanged().unsubscribeAll(this),this._dataSource.destroy(),null!==this._definitionsViewModel&&(this._definitionsViewModel.destroy(),this._definitionsViewModel=null),this._unsubscribeApplyInputsOnSeriesCompleted(),this._isDestroyed=!0,super.destroy()}stop(){super.stop(),this._isDestroyed||(this._dataSource.stop(),this.clearData())}start(){super.start(),this._isDestroyed||null===this._inputs||this._dataSource.start()}metaInfo(){return this._metaInfo}graphicsInfo(){return this._metaInfo.graphics}series(){return this._model.mainSeries()}translatedType(){return this._metaInfo.description}name(){return this._metaInfo.description}studyId(){return this._metaInfo.id}setPoint(t,e,s){super.setPoint(t,this._preparePoint(e,s))}move(t){}clearData(){this._clearAllDataExceptPointsetPoints(),this._pointsetPoints=null,this.updateAllViews((0,m.sourceChangeEvent)(this.id()))}data(){return this.plots()}plots(){
return this._loadedPlots||this._dataSource.plots()}graphics(){return this._loadedGraphics||this._dataSource.graphics()}firstValue(){return this._model.mainSeries().firstValue()}state(t){const e=super.state(t);let s;this.metaInfo()instanceof d.StudyMetaInfo?s=this.metaInfo().state():(s=(0,n.clone)(this.metaInfo()),s.id=d.StudyMetaInfo.parseIdString(s.id+(s.version?"-"+s.version:"")).fullId);const i={...e,metaInfo:s};return t&&(i.data=this.plots().state(),i.nonseriesindexes=this._indexes,i.graphics=(0,u.saveStudyGraphics)(this.graphics())),i}restoreData(t){var e;void 0!==t.data&&(this._loadedPlots=new r.PlotList((0,p.studyPlotFunctionMap)(this._metaInfo),p.studyEmptyPlotValuePredicate),this._loadedPlots.restoreState(t.data)),this._indexes=null!==(e=t.nonseriesindexes)&&void 0!==e?e:this._indexes,this._loadedGraphics=t.graphics?(0,u.loadStudyGraphics)(t.graphics):this._loadedGraphics}getPropertyDefinitionsViewModel(){return null===this._definitionsViewModel?this._getPropertyDefinitionsViewModelClass().then((t=>null===t||this._isDestroyed?null:(null===this._definitionsViewModel&&(this._definitionsViewModel=new t(this._model.undoModel(),this)),this._definitionsViewModel))):Promise.resolve(this._definitionsViewModel)}paneViews(t){let e=[];if(this.isSourceHidden())return e;if(this._isReady()&&this._changeStatesStack.isEmpty()){const s=super.paneViews(t);null!==s&&(e=e.concat(s))}else null!==this._beingCreatedPaneView&&e.push(this._beingCreatedPaneView);return null!==this._anchorsPaneView&&e.push(this._anchorsPaneView),e}propertiesChanged(t){super.propertiesChanged(t),this._onStudyInputsMayChange()}dataAndViewsReady(){return super.dataAndViewsReady()&&this._isReady()}endChanging(t,e){const s=super.endChanging(t,e);return s.indexesChanged?this.clearData():this._updateAnchorsPrice(!0),s}moveData(t){this._dataSource.moveData(t)}restorePoints(t,e,s){super.restorePoints(t,e,s),this._updateAnchorsPrice(!0)}realign(){super.realign(),null===this._model.mainSeries().symbolInfo()&&(this._alignerCache=null)}statusProvider(t){return this._statusProvider}statusView(){return this._statusView}legendView(){return null}dataProblemModel(){return null}dataUpdatedModeModel(){return null}marketStatusModel(){return null}onStatusChanged(){return this._dataSource.studyStatusChanged()}status(){return this._dataSource.studyStatus()}recalcStudyIfNeeded(){}static createPropertiesFromStudyMetaInfoAndState(t,e,s,i){const n=(0,_.prepareStudyPropertiesForLoadChart)(t,e,s,null,i);return this._configureProperties(n),n}_onStudyStatusChanged(t,e){let s;switch(e.type){case h.StudyStatusType.Error:s=!0;break;case h.StudyStatusType.Completed:s=!1;break;default:return}if(s===this._isLegendDisplayed)return;this._isLegendDisplayed=s;const i=this._model.paneForSource(this);if(i){const t=this._model.panes().indexOf(i),e=I.InvalidationMask.invalidateLegendWidgetLayout(t);this.model().invalidate(e)}}_studyId(){return this._dataSource.studyId()}_isReady(){return!0}_updateAllPaneViews(t){var e,s;super._updateAllPaneViews(t),
null===(e=this._beingCreatedPaneView)||void 0===e||e.update(),null===(s=this._anchorsPaneView)||void 0===s||s.update(t)}_getPointTime(t,e){const s=t.index,i=this._model.timeScale().indexToTimePoint(s);if(null!==i)return i;if(e||void 0===t.time)return null;const n=this._model.mainSeries().symbolInfo();if(null===n)return null;let r=this._model.properties().childs().timezone.value();"exchange"===r&&(r=n.timezone);const o=(0,y.cal_to_utc)((0,y.get_timezone)(r),t.time);return this._getStartBarAligner()(o)/1e3}_updateAnchorsPrice(t){}_onPointsetUpdated(t){super._onPointsetUpdated(t),this._pointsetPoints=this._points.map((t=>({price:t.price,index:t.index,time:t.time}))),this._onStudyInputsMayChange()}_onDataCleared(){this.updateAllViews((0,m.sourceChangeEvent)({sourceId:this.id(),clearData:!0})),this._model.updateSource(this)}_onDataUpdated(t,e,s){var i;this._updateAnchorsPrice(),this.updateAllViews((0,m.sourceChangeEvent)({sourceId:this.id(),firstUpdatedTimePointIndex:null===(i=t[0])||void 0===i?void 0:i.index})),this._model.updateSource(this)}_onStudyInputsMayChange(){let t=null;if(null!==this._pointsetPoints&&this._pointsetPoints.length===this.pointsCount()&&(t=this._studyInputs(this._pointsetPoints),null===t&&(this._clearAllDataExceptPointsetPoints(),this.updateAllViews((0,m.sourceChangeEvent)(this.id())))),null!==t){const e=this.metaInfo().inputs.map((t=>t.id)),s=Object.keys(t);for(const i of s)e.includes(i)||delete t[i]}this._areInputsEqual(this._inputs,t)||this._applyStudyInputs(t)}_preparePoint(t,e){return super._preparePoint(this._alignPointToRangeOfActualData(t),e)}_getPropertyDefinitionsViewModelClass(){return Promise.resolve(null)}_subscribeApplyInputsOnSeriesCompleted(){this._unsubscribeApplyInputsOnSeriesCompleted(),this._model.mainSeries().dataEvents().completed().subscribe(this,(()=>this._onStudyInputsMayChange()),!0)}_unsubscribeApplyInputsOnSeriesCompleted(){this._model.mainSeries().dataEvents().completed().unsubscribeAll(this)}_onInputsChanged(){this.hasAlert.value()&&(this._localAndServerAlertsMismatch=!0)}static _createPropertiesFromStudyIdAndState(t,e){const s=d.StudyMetaInfo.getStudyPropertyRootNameById(t),i=new a.DefaultProperty(s,e);return this._configureProperties(i),i}static _configureProperties(t){super._configureProperties(t),t.removeExclusion("intervalsVisibilities")}_areInputsEqual(t,e){return null===e?null===t:null!==t&&(0,l.areStudyInputsEqual)(this._metaInfo.inputs,t,e)}_applyStudyInputs(t){const e=this._inputs;this._inputs=t,null!==t&&(this._unsubscribeApplyInputsOnSeriesCompleted(),this._dataSource.setInputs(t),null===e&&this.isStarted()&&!this._dataSource.isStarted()&&this._dataSource.start()),this._onInputsChanged()}_clearAllDataExceptPointsetPoints(){this._inputs=null,this._dataSource.clearData(),this._loadedPlots=null,this._indexes=null,this._loadedGraphics=null}_getStartBarAligner(){const t=this._model.mainSeries().interval();return null!==this._alignerCache&&this._alignerCache.resolution===this._model.mainSeries().interval()||(this._alignerCache={resolution:t,aligner:(0,
S.createTimeToBarTimeAligner)(t,(0,i.ensureNotNull)(this._model.mainSeries().symbolInfo()))}),this._alignerCache.aligner}}},667791:(t,e,s)=>{s.d(e,{LineToolVbPFixed:()=>m});var i=s(277973),n=s(588537),r=s(244276),o=s(970028),a=s(417791),d=s(721925),u=s(104458),l=s(194459),c=s(270617),h=s(346090),p=s(491791);const _=(0,r.studyIdString)("VbPFixed","tv-volumebyprice");function y(t,e,s,i){return e.styles&&(S(e.styles.developingPoc),S(e.styles.developingVAHigh),S(e.styles.developingVALow)),e}function S(t){void 0!==t&&void 0!==t.visible&&(t.display=t.visible?15:0,delete t.visible)}class m extends a.StudyLineDataSource{constructor(t,e,s,i,n,r){const o=s||t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:_}),a=null!=e?e:m.createProperties(t);super(t,o,"vbpfixed_",a,n,r),(0,d.createGraphicsPaneViews)(this,t).then((e=>{if(i=t.mainSeries(),o.plots.length>0){const s=new u.StudyPlotPaneView(this,i,t,o.plots[0].id);e.push(s)}if(o.plots.length>1){const s=new u.StudyPlotPaneView(this,i,t,o.plots[1].id);e.push(s)}if(o.plots.length>2){const s=new u.StudyPlotPaneView(this,i,t,o.plots[2].id);e.push(s)}this._setPaneViews(e)})),this.clearData()}pointsCount(){return 2}boundToSymbol(){return!1}offset(t){return 0}getMinFirstBarIndexForPlot(){return-1/0}calcIsActualSymbol(){this._isActualSymbol=!0,this._isActualCurrency=!0,this._isActualUnit=!0,this.calcIsActualInterval()}cloneable(){return!1}isSynchronizable(){return!1}isPlotVisibleAt(t,e){return(this.properties().childs().styles.childs()[t].childs().display.value()&e)===e}static createProperties(t,e){const s=o.StudyMetaInfo.getStudyPropertyRootNameById(_),i=(0,n.ensureNotNull)(t.studyMetaInfoRepository().findByIdSync({type:"java",studyId:_})),r=(0,h.createDefaultsState)(!0,s,[],t.studyVersioning());return this.createPropertiesFromStudyMetaInfoAndState(i,i,(0,c.merge)((0,c.clone)(r),null!=e?e:{}),t.studyVersioning())}static createPropertiesFromStudyMetaInfoAndState(t,e,s,i){const n=(0,p.prepareStudyPropertiesForLoadChart)(t,e,s,null,i,y);return this._configureProperties(n),n}static studyId(){return _}_studyInputs(t){(0,n.assert)(2===t.length,"all the line tool points should be defined");const[e,s]=t,i=Math.max(e.index,s.index),r=this._model.mainSeries().bars().lastIndex(),o=this._getPointTime(e.index<=s.index?e:s,!0),a=this._getPointTime(s.index>=e.index?s:e,!0);if(null===o||null===a)return this._subscribeApplyInputsOnSeriesCompleted(),null;return{...this.properties().childs().inputs.state(),first_bar_time:1e3*o,last_bar_time:1e3*a,subscribeRealtime:r===i}}_isReady(){return!(0,d.isStudyGraphicsEmpty)(this.graphics())}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([s.e(39509),s.e(64320),s.e(39261),s.e(60607)]).then(s.bind(s,601173))).StudyLineDataSourceDefinitionsViewModel}_onDataUpdated(){this._updateAnchors(),this.updateAllViews((0,l.sourceChangeEvent)(this.id())),this._model.updateSource(this)}_updateAnchors(){const t=this._calculateAnchors();if(!t)return;const[{index:e,price:s},{index:i,price:n}]=t;if(this._timePoint.length&&(this._timePoint[0].price=s,
this._timePoint[1].price=n),this._points.length){const t=this.model().timeScale(),r=t.indexToTimePoint(e),o=t.indexToTimePoint(e);this._points[0]={index:e,price:s,time:(0,c.isNumber)(r)?new Date(1e3*r):void 0},this._points[1]={index:i,price:n,time:(0,c.isNumber)(o)?new Date(1e3*o):void 0}}}_calculateAnchors(){let t=null,e=null,s=null,n=null;if(this.graphics().hhists().forEach((i=>{i.forEach((i=>{const{priceLow:r,priceHigh:o,firstBarTime:a,lastBarTime:d}=i;(!t||r<t)&&(t=r),(!e||o>e)&&(e=o),(!s||a<s)&&(s=a),(!n||d>n)&&(n=d)}))})),!((0,i.default)(t)||(0,i.default)(e)||(0,i.default)(n)||(0,i.default)(s)))return[{price:e,index:s},{price:t,index:n}]}_updateAnchorsPrice(){const t=this._calculateAnchors();if(!t)return;const[{price:e},{price:s}]=t;this._timePoint.length&&(this._timePoint[0].price=e,this._timePoint[1].price=s),this._points.length&&(this._points[0].price=e,this._points[1].price=s)}}},707127:(t,e,s)=>{s.d(e,{PaneRendererClockIcon:()=>o});var i=s(218718),n=s(380047);const r=Math.sqrt(3);class o extends n.ScaledPaneRenderer{constructor(t){super(),this.update(t)}update(t){var e;const s=t.points[0],i=null!==(e=t.points[1])&&void 0!==e?e:t.points[0],n=s.x-i.x,o=s.y-i.y;let a=t.horzMargin;void 0===a&&(a=n>0?10:-25),this._x=s.x+a,this._y=s.y+(0!==o&&Math.abs(n)*r<=Math.abs(o)?-7:o>0?-25:11),this._color=t.color}hitTest(t){return t.x<this._x||t.x>this._x+16||t.y<this._y||t.y>this._y+16?null:new i.HitTestResult(i.HitTestResult.REGULAR)}_drawImpl(t){t.save(),t.translate(this._x-.5,this._y-.5),t.beginPath(),t.arc(8,9,6,0,2*Math.PI,!0),t.closePath(),t.moveTo(8,9),t.arc(8.5,5.5,.5,Math.PI,0),t.lineTo(9,10),t.arc(5.5,9.5,.5,.5*Math.PI,1.5*Math.PI),t.closePath(),t.moveTo(1.71,5.93),t.bezierCurveTo(-.61,2.83,3.86,-.76,6.39,2.18),t.bezierCurveTo(4.35,2.67,2.63,4.04,1.71,5.93),t.closePath(),t.moveTo(14.29,5.93),t.bezierCurveTo(16.61,2.83,12.14,-.76,9.61,2.18),t.bezierCurveTo(11.65,2.67,13.37,4.04,14.29,5.93),t.fillStyle=this._color,t.fill(),t.restore()}}},183939:(t,e,s)=>{var i;s.d(e,{StudyStatusType:()=>i}),function(t){t[t.Undefined=0]="Undefined",t[t.Loading=1]="Loading",t[t.Completed=2]="Completed",t[t.Error=3]="Error"}(i||(i={}))},12270:(t,e,s)=>{s.r(e),s.d(e,{StudyDataSource:()=>_});var i=s(588537),n=s(97639),r=s.n(n),o=s(752280),a=s(695078),d=s(476543),u=s(523083),l=s(211014),c=s(183939);const h=(0,s(911905).getLogger)("Chart.StudyDataSource");var p;!function(t){t[t.Idle=0]="Idle",t[t.AwaitingConnection=1]="AwaitingConnection",t[t.AwaitingParent=2]="AwaitingParent",t[t.AwaitingFirstDataUpdate=3]="AwaitingFirstDataUpdate",t[t.Active=4]="Active"}(p||(p={}));class _{constructor(t,e,s,i){this._inputs=null,this._status=p.Idle,this._studyId=null,this._turnaroundCounter=1,this._studyStatus={type:c.StudyStatusType.Undefined},this._studyStatusChanged=new(r()),this._graphics=new l.LiveStudyGraphics,this._dataCleared=new(r()),this._dataUpdated=new(r()),this._boundOnGatewayIsConnectedChanged=this._onGatewayIsConnectedChanged.bind(this),this._ongoingDataUpdate=Promise.resolve(),this._gateway=t,this._metaInfo=i,this._seriesSource=e,
this._turnaroundPrefix=s,this._plots=new o.PlotList((0,u.studyPlotFunctionMap)(i),u.studyEmptyPlotValuePredicate),this._gateway.isConnected().subscribe(this._boundOnGatewayIsConnectedChanged)}destroy(){this.stop(),this._gateway.isConnected().unsubscribe(this._boundOnGatewayIsConnectedChanged),this._dataUpdated.destroy(),this._dataCleared.destroy(),this._studyStatusChanged.destroy()}metaInfo(){return this._metaInfo}inputs(){return this._inputs}setInputs(t){this._inputs=t,null!==this._studyId&&(this._turnaroundCounter++,this._onStudyStatusChangedTo({type:c.StudyStatusType.Undefined}),this._gateway.modifyStudy(this._studyId,this._turnaround(),t,this._onMessage.bind(this)),this._status===p.Active&&this._changeStatusTo(p.AwaitingFirstDataUpdate))}isStarted(){return this._status!==p.Idle}isActive(){return this._status===p.Active}start(){this.isStarted()?h.logNormal("start: data source is already started, nothing to do"):((0,i.assert)(null!==this._inputs,"Inputs should be defined when starting a study data source"),this._gateway.isConnected().value()?this._createStudy():this._changeStatusTo(p.AwaitingConnection))}stop(){this.isStarted()?(null!==this._studyId&&(this._gateway.removeStudy(this._studyId),this._studyId=null,this._onStudyStatusChangedTo({type:c.StudyStatusType.Undefined})),this._changeStatusTo(p.Idle)):h.logNormal("stop: data source is already stopped, nothing to do")}studyId(){return this._studyId}studyStatus(){return this._studyStatus}studyStatusChanged(){return this._studyStatusChanged}plots(){return this._plots}graphics(){return this._graphics}clearData(){this._plots.clear(),this._graphics.clear(),this._dataCleared.fire()}stopAndStealData(){(0,i.assert)(this._status===p.Active,"Couldn't steal data from non-active data source"),this.stop();const t=this._plots,e=this._graphics.extract();return this._plots=new o.PlotList((0,u.studyPlotFunctionMap)(this._metaInfo),u.studyEmptyPlotValuePredicate),{plots:t,graphics:e}}dataCleared(){return this._dataCleared}dataUpdated(){return this._dataUpdated}moveData(t){this._ongoingDataUpdate=this._ongoingDataUpdate.then((()=>{this._plots.move(t)}))}pendingUpdatesReady(){return this._ongoingDataUpdate}_changeStatusTo(t){(0,i.assert)(this._status!==t,"Source and destination status should be distinct"),h.logNormal(`Status changed from ${p[this._status]} to ${p[t]}`),this._status=t}_createStudy(){const t=this._seriesSource.instanceId();null!==t?this._createStudyUsingParentId(t):(this._changeStatusTo(p.AwaitingParent),this._seriesSource.dataEvents().completed().subscribe(this,this._onSeriesCompleted,!0))}_createStudyUsingParentId(t){(0,i.assert)(this._status!==p.Active,'Status should not be "Active" when creating a study'),(0,i.assert)(this._studyStatus.type===c.StudyStatusType.Undefined,'Study status should be "Undefined" when creating a study'),(0,i.assert)(null===this._studyId,"Study id should be empty when creating a study"),this._studyId=(0,d.makeNextStudyId)(),
this._gateway.createStudy(this._studyId,this._turnaround(),t,this._metaInfo.fullId+("tv-basicstudies"===this._metaInfo.packageId?"":"!"),(0,i.ensureNotNull)(this._inputs),this._onMessage.bind(this)),this._changeStatusTo(p.AwaitingFirstDataUpdate)}_onGatewayIsConnectedChanged(t){t?this._onGatewayConnected():this._onGatewayDisconnected()}_onGatewayConnected(){this._status===p.AwaitingConnection&&this._createStudy()}_onGatewayDisconnected(){this._status!==p.Idle&&this._status!==p.AwaitingConnection&&(this._studyId=null,this._changeStatusTo(p.AwaitingConnection),this._studyStatus.type!==c.StudyStatusType.Undefined&&this._onStudyStatusChangedTo({type:c.StudyStatusType.Undefined})),this._turnaroundCounter=1}_onSeriesCompleted(){this._status===p.AwaitingParent&&this._createStudyUsingParentId((0,i.ensure)(this._seriesSource.instanceId()))}_onStudyStatusChangedTo(t){const e=this._studyStatus;this._studyStatus=t,h.logNormal(`Study status type changed from ${c.StudyStatusType[e.type]} to ${c.StudyStatusType[t.type]}`),this._studyStatusChanged.fire(e,t)}_onMessage(t){if("data_update"===t.method){const{customId:e,turnaround:s,plots:n,nonseries:r}=t.params;e===this._studyId&&this._checkTurnaround(s)&&this._onDataUpdate(n,(0,i.ensureDefined)(r))}else if("study_loading"===t.method){const[e,s,i]=t.params;e===this._studyId&&this._checkTurnaround(s)&&this._onStudyLoading(i)}else if("study_completed"===t.method){const[e,s,i]=t.params;e===this._studyId&&this._checkTurnaround(s)&&this._onStudyCompleted(i)}else if("study_error"===t.method){const[e,s,i,n,r]=t.params;e===this._studyId&&this._checkTurnaround(s)&&this._onStudyError(i,n,r)}else"clear_data"===t.method&&this._checkTurnaround(t.params.turnaround)&&this.clearData()}_onDataUpdate(t,e){const s=(0,a.unpackNonSeriesData)(e.d);return this._ongoingDataUpdate=this._ongoingDataUpdate.then((()=>s),(()=>s)).then(this._onDataUnpacked.bind(this,t,e.indexes)),this._ongoingDataUpdate}_onDataUnpacked(t,e,s){this._status!==p.Idle&&(this._status===p.AwaitingFirstDataUpdate&&(this._changeStatusTo(p.Active),this.clearData()),this._mergePlots(t),null!==s&&(s.indexes_replace?((0,i.assert)("nochange"!==e),this._graphics.replaceIndexesTo(e)):("nochange"!==e&&this._graphics.replaceIndexesTo(e),void 0!==s.graphicsCmds&&this._graphics.processCommands(s.graphicsCmds,this._metaInfo.graphics))),this._dataUpdated.fire(t,s,e))}_onStudyLoading(t){this._onStudyStatusChangedTo({type:c.StudyStatusType.Loading,startTime:Date.now()})}_onStudyError(t,e,s){this.clearData();const i="string"==typeof t?{error:t.split(":",2)[0]}:t;this._onStudyStatusChangedTo({type:c.StudyStatusType.Error,errorDescription:i})}_onStudyCompleted(t){this._onStudyStatusChangedTo({type:c.StudyStatusType.Completed})}_mergePlots(t){this._plots.merge(t)}_turnaround(){return`${this._turnaroundPrefix}${this._turnaroundCounter}`}_checkTurnaround(t){const e=this._turnaround();return t===e||t===this._seriesSource.turnaround()||t===`${this._seriesSource.turnaround()}_${e}`}}},127641:(t,e,s)=>{var i;s.d(e,{Constants:()=>i}),function(t){
t.DrawingIconColor="rgba( 170, 170, 170, 1)",t[t.NameLengthLimit=300]="NameLengthLimit"}(i||(i={}))}}]);