(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[63191],{364019:(e,n,t)=>{"use strict";t.d(n,{normalizeIntervalString:()=>f,isAvailable:()=>_,setLastUsedResolution:()=>v,getDefaultResolution:()=>S,getResolutionByChartStyle:()=>m,getApplicableInterval:()=>R,getServerInterval:()=>y,isResolutionMultiplierValid:()=>h,getMaxResolutionValue:()=>P,convertResolutionsFromSettings:()=>T,mergeResolutions:()=>g,sortResolutions:()=>w,getTranslatedResolution:()=>b,getTranslatedResolutionModel:()=>C,isSecondsEnabled:()=>U});var r=t(575932),i=t(273044),s=t(749473),o=t(62802),a=t(583912),c=t(977809),u=t(270617);t(611688);const l={[i.ResolutionKind.Ticks]:1,[i.ResolutionKind.Seconds]:60,[i.ResolutionKind.Minutes]:1440,[i.SpecialResolutionKind.Hours]:24,[i.ResolutionKind.Days]:365,[i.ResolutionKind.Weeks]:52,[i.ResolutionKind.Months]:12,[i.ResolutionKind.Range]:1e6,[i.ResolutionKind.Invalid]:NaN},d={[i.ResolutionKind.Ticks]:0,[i.ResolutionKind.Seconds]:1,[i.ResolutionKind.Minutes]:2,[i.SpecialResolutionKind.Hours]:3,[i.ResolutionKind.Days]:4,[i.ResolutionKind.Weeks]:5,[i.ResolutionKind.Months]:6,[i.ResolutionKind.Range]:7,[i.ResolutionKind.Invalid]:8},p={[i.ResolutionKind.Invalid]:"",[i.ResolutionKind.Ticks]:(0,r.t)("T",{context:"interval_short"}),[i.ResolutionKind.Seconds]:(0,r.t)("s",{context:"interval_short"}),[i.ResolutionKind.Minutes]:(0,r.t)("m",{context:"interval_short"}),[i.SpecialResolutionKind.Hours]:(0,r.t)("h",{context:"interval_short"}),[i.ResolutionKind.Days]:(0,r.t)("D",{context:"interval_short"}),[i.ResolutionKind.Weeks]:(0,r.t)("W",{context:"interval_short"}),[i.ResolutionKind.Months]:(0,r.t)("M",{context:"interval_short"}),[i.ResolutionKind.Range]:(0,r.t)("R",{context:"interval_short"})};function f(e){return i.Interval.parse(e).value()}function _(e){const n=i.Interval.parse(e);if(n.isRange())return a.linking.range.value();const t=n.value(),r=a.linking.dataFrequencyResolution.value();if(void 0!==r&&D(t,r)<0)return!1;const s=a.linking.supportedResolutions.value();return void 0!==s?void 0!==s.find((e=>f(e)===t)):n.isIntraday()?Boolean(a.linking.intraday.value()):n.isDWM()}function v(e){i.Interval.isValid(e)&&(i.Interval.isRange(e)?o.setValue("chart.lastUsedRangeResolution",e):o.setValue("chart.lastUsedTimeBasedResolution",e))}function S(e){return e?"100R":"1D"}function m(e,n,t){const r=s.isRangeStyle(e),a=i.Interval.isRange(n);return!r&&a?function(e){const n=o.getValue("chart.lastUsedTimeBasedResolution");if(void 0!==n&&i.Interval.isTimeBased(n))return n;let t="1D";for(const n of e){const e=i.Interval.parse(n);if(e.isTimeBased()){const n=e.value();if("1D"===n)return n;t=n}}return t}(t):r&&!a?function(e){const n=o.getValue("chart.lastUsedRangeResolution");if(void 0!==n&&i.Interval.isRange(n))return n;let t="100R";for(const n of e){const e=i.Interval.parse(n);if(e.isRange()){const n=e.value();if("100R"===n)return n;t=n}}return t}(t):n}function R(e,n){return D(n,e)>=0?n:e}function y(e){return i.Interval.isRange(e)?"1":e}function h(e){const{interval:n,guiResolutionKind:t}=i.Interval.parseExt(e)
;if(!n.isValid())return!1;return(t===i.SpecialResolutionKind.Hours?n.multiplier()/60:n.multiplier())<=A(t)}function A(e){const n=l[e];return Number.isNaN(n)?1:n}function P(e){return A(i.Interval.parseExt(e).guiResolutionKind)}function T(e){return Array.isArray(e)?e:Object.keys(e).map(i.Interval.normalize).filter(u.notNull)}function g(...e){let n=[].concat(...e);return n=(0,c.uniq)(n.filter(h).map(f)),w(n)}function w(e){return e.sort(D)}function I(e){const n=i.Interval.parse(e),t=n.multiplier()||1;return n.isMinuteHours()?[i.SpecialResolutionKind.Hours,t/60]:[n.kind(),t]}function D(e,n){if(e===n)return 0;const[t,r]=I(e),[i,s]=I(n);return t!==i?d[t]-d[i]:r-s}function b(e){const{multiplier:n,shortKind:t}=C(e);return`${n}${t}`}function C(e,n){const t=i.Interval.parse(e);let r=t.multiplier(),s=t.kind();if(!t.isValid()){if(n)return null;throw new TypeError("Can't translate invalid interval")}return t.isMinuteHours()&&(r=Math.floor(r/60),s=i.SpecialResolutionKind.Hours),{multiplier:r.toString(),shortKind:x(s),hint:`${r} ${x(s,r)}`,mayOmitMultiplier:t.isDWM()&&1===r,mayOmitShortKind:t.isMinutes()&&!t.isMinuteHours()}}function x(e,n){if(!n)return p[e];switch(e){case i.ResolutionKind.Ticks:return(0,r.t)("tick",{plural:"ticks",count:n});case i.ResolutionKind.Days:return(0,r.t)("day",{plural:"days",count:n});case i.ResolutionKind.Weeks:return(0,r.t)("week",{plural:"weeks",count:n});case i.ResolutionKind.Months:return(0,r.t)("month",{plural:"months",count:n});case i.ResolutionKind.Seconds:return(0,r.t)("second",{plural:"seconds",count:n});case i.ResolutionKind.Minutes:return(0,r.t)("minute",{plural:"minutes",count:n});case i.SpecialResolutionKind.Hours:return(0,r.t)("hour",{plural:"hours",count:n});case i.ResolutionKind.Range:return(0,r.t)("range",{plural:"ranges",count:n});default:return e}}function U(){return!0}},366156:(e,n,t)=>{"use strict";var r=t(97639),i=t(823127),s=t(575932).t,o=t(588537).assert,a=t(345848).trackEvent,c=t(226722).TVXWindowEvents,u=t(911905).getLogger("Pine.ScriptLib"),l=t(175203).telemetry,d=t(251954),p={fast:["delete","get","is_auth_to_get","is_auth_to_write","parse_title","rename","lib_list"],medium:["list","eval_pine_ex","translate_light"],slow:["process_legacy","publish","save","translate","translate_source","gen_alert"]};var f={};function _(){f._cache={}}f._isAuthCache=new _,f._pineDeleted=new r,c.on("TVScriptModified",(function(e){f.clearSavedScriptsCache(),f.scriptUpdater()&&f.scriptUpdater().onTVScriptModified(JSON.parse(e))})),c.on("TVScriptDeleted",(function(e){f.clearAllCaches(),f.scriptUpdater()&&f.scriptUpdater().onTVScriptDeleted(JSON.parse(e))})),c.on("TVScriptRenamed",(function(e){f.clearSavedScriptsCache(),f.scriptUpdater()&&f.scriptUpdater().onTVScriptRenamed(JSON.parse(e))})),c.on("TVScriptLegacyPineProcessed",(function(e){f.clearSavedScriptsCache(),f.scriptUpdater()&&f.scriptUpdater().onTVScriptLegacyPineProcessed(JSON.parse(e))})),f.getPineFacadeUrl=function(){return window.PINE_URL},f.PINE_FACADE_URL=function(){return window.PINE_URL},f.onPineDeleted=function(){return f._pineDeleted
},f._pineFacadeAjax=function(e,n,t,r){u.logNormal("Requesting pine facade scripts, url: "+n);var s=function(e,n){for(var t=Object.keys(p),r=0;r<t.length;r++){var i=p[t[r]].filter((function(n){return-1!==e.indexOf(n)}));if(Boolean(i.length))return t[r]}return!1}(n),o=Date.now(),a=r?void 0:{withCredentials:!0};return i.ajax({url:f.PINE_FACADE_URL()+n,type:e,data:t||{},dataType:"json",xhrFields:a}).done((function(){var e=Date.now()-o;l.sendReport("pine",s+"_group_time_frame",{value:e}),l.sendReport("pine",s+"_group_ok"),u.logNormal("Requesting pine facade scripts finished, url: "+n)})).fail((function(){var e=Date.now()-o;l.sendReport("pine",s+"_group_time_frame",{value:e}),l.sendReport("pine",s+"_group_error"),u.logError("Requesting pine facade scripts failed, url: "+n)}))},f.convertScript=function(e,n){var t=i.Deferred(),r={source:e,version_to:n};return f._pineFacadeAjax("POST","/convert/",r).done((function(e,n,r){e.error?t.reject(f._readableError(e.error)):t.resolve(e)})).fail((function(e,n,r){f._anyRequestAsyncFail(t,e)})),t.promise()},f.translateScriptAsync=function(e,n,t,r){a("Pine","ScriptLib.translateScript"),r=!!r;var s=i.Deferred(),o="/translate_source/"+encodeURIComponent(n)+"/?is_pine_ex="+r,c={user_name:window.user&&window.user.username,source:e,inputs:JSON.stringify(t||{})};return f._pineFacadeAjax("POST",o,c).done((function(e,n,t){f._translateScriptAsyncDone(s,e)})).fail((function(e,n,t){f._anyRequestAsyncFail(s,e)})),s.promise()},f.translateScriptAsync2=function(e,n){u.logNormal("translateScriptAsync2, pineId="+e+" pineVersion="+n),a("Pine","ScriptLib.translateScript");var t=i.Deferred(),r=0!==e.indexOf("USER"),s=window.user&&window.user.username,o="?user_name="+encodeURIComponent(s),l="/translate/"+encodeURIComponent(e)+"/"+n+"/";return r||null==s||(l+=o),f._pineFacadeAjax("GET",l,void 0,r).done((function(e,r,i){if(f._translateScriptAsyncDone(t,e),n<0){f.clearSavedScriptsCache();var s={scriptMetaInfo:e.result.metaInfo};c.emit("TVScriptLegacyPineProcessed",JSON.stringify(s)),d.emit("TVScriptLegacyPineProcessed",s),setTimeout((function(){s.isSelfCall=!0,null!=f.scriptUpdater()&&f.scriptUpdater().onTVScriptLegacyPineProcessed(s)}),0)}})).fail((function(e,n,r){f._anyRequestAsyncFail(t,e)})),t.promise()},f._translateScriptAsyncDone=function(e,n){if(n.error)e.reject(f._readableError(n.error));else if(n.success)e.resolve(n.result.metaInfo,n.result.IL);else{var t=n.result?n.result.metaInfo:null;e.reject(n.reason,t)}},f._saveScriptAsyncDone=function(e,n){if(n.error)e.reject(f._readableError(n.error));else if(n.success)e.resolve(n.result.metaInfo);else{var t=n.result?n.result.metaInfo:null;e.resolve(t,n.reason)}},f._generateAlertAsyncDone=function(e,n){if(n.error)e.reject(f._readableError(n.error));else if(n.success)e.resolve(n.result.metaInfo,n.result.IL,n.result.inputs||null,n.result.gen_alert_data||null);else{var t=n.result?n.result.metaInfo:null;e.reject(n.reason,t)}},f._readableError=function(e,n){return n},f._anyRequestAsyncFail=function(e,n){
0===f.PINE_FACADE_URL().indexOf("http")&&u.logError(n.responseText),e.reject(f._readableError(n.status,n.statusText))},f.isAuthToWritePineScript=function(e){var n="write_"+e,t=f._isAuthCache.getPromise(n);if(null!==t)return t;a("Pine","ScriptLib.isAuthToWritePineScript");var r=i.Deferred(),s="/is_auth_to_write/"+encodeURIComponent(e);return f._pineFacadeAjax("GET",s).done((function(e,n,t){r.resolve(e)})).fail((function(e,n,t){f._anyRequestAsyncFail(r,e)})),f._isAuthCache.setPromise(n,r.promise())},f.isAuthToGetPineSourceCode=function(e,n){var t="get_"+e+"_"+n,r=f._isAuthCache.getPromise(t);if(null!==r)return r;a("Pine","ScriptLib.isAuthToGetPineSourceCode");var s=i.Deferred(),o="/is_auth_to_get/"+encodeURIComponent(e)+"/"+n;return f._pineFacadeAjax("GET",o).done((function(e,n,t){s.resolve(e)})).fail((function(e,n,t){f._anyRequestAsyncFail(s,e)})),f._isAuthCache.setPromise(t,s.promise())},_.prototype.getPromise=function(e){var n=f._cache[e];return void 0===n?null:void 0!==n.value?i.Deferred().resolve(n.value):void 0!==n.promise?n.promise:null},_.prototype.setPromise=function(e,n){return f._cache[e]={promise:n},n.done((function(n){f._cache[e]={value:n}})).fail((function(n){delete f._cache[e]})),n},f.getPineSourceCode=function(e,n,t){a("Pine","ScriptLib.getPineSourceCode");var r=i.Deferred(),s="?no_4xx="+!!t,o="/get/"+encodeURIComponent(e)+"/"+n+s;return f._pineFacadeAjax("GET",o).done((function(e,n,t){!1===e.success?r.reject(e.reason):r.resolve(e)})).fail((function(e,n,t){f._anyRequestAsyncFail(r,e)})),r.promise()},f.saveNewDraft=function(e){a("Pine","ScriptLib.saveNewDraft");var n=i.Deferred();if(null==e||""===e)return n.reject(s("Cannot save empty source code"));var t=window.user&&window.user.username,r="/save/new_draft/?user_name="+encodeURIComponent(t)+"&allow_use_existing_draft=true",o={source:e};return f._pineFacadeAjax("POST",r,o).done((function(e,t,r){f._translateScriptAsyncDone(n,e)})).fail((function(e,t,r){f._anyRequestAsyncFail(n,e)})),n.promise()},f.saveNextDraft=function(e,n,t){a("Pine","ScriptLib.saveNextDraft");var r=i.Deferred();if(null==n||""===n)return r.reject(s("Cannot save empty source code"));var o=window.user&&window.user.username,c=(t=!!t,"/save/next_draft/"+encodeURIComponent(e)+"/?user_name="+encodeURIComponent(o)+"&allow_create_new="+t),u={source:n};return f._pineFacadeAjax("POST",c,u).done((function(e,n,t){f._translateScriptAsyncDone(r,e)})).fail((function(e,n,t){f._anyRequestAsyncFail(r,e)})),r.promise()},f.processLegacy=function(e,n){a("Pine","ScriptLib.processLegacy");var t=i.Deferred(),r=window.user&&window.user.username,s="/process_legacy/"+encodeURIComponent(e)+"/?user_name="+encodeURIComponent(r),o={};return null!=n&&""!==n&&(o.source=n),f._pineFacadeAjax("POST",s,o).done((function(e,n,r){f._translateScriptAsyncDone(t,e)})).fail((function(e,n,r){f._anyRequestAsyncFail(t,e)})),t.promise()},f.generateAlert=function(e){a("Pine","ScriptLib.generateAlert");var n=i.Deferred(),t=window.user&&window.user.username,r="/gen_alert/?user_name="+encodeURIComponent(t),s={alert_info:e},o=Date.now()
;return f._pineFacadeAjax("POST",r,s).done((function(e,t,r){l.sendReport("alerts","compilation_ok"),f._generateAlertAsyncDone(n,e)})).fail((function(e,t,r){l.sendReport("alerts","compilation_error"),f._anyRequestAsyncFail(n,e)})).always((function(){var e=Date.now()-o;l.sendReport("alerts","compilation_time_frame",{value:e})})),n.promise()},f.parseScriptTitleAsync=function(e){a("Pine","ScriptLib.parseScriptTitle");var n=i.Deferred();if(null==e||""===e)return n.reject(s("Cannot save empty source code"));var t={user_name:window.user&&window.user.username,source:e};return f._pineFacadeAjax("POST","/parse_title/",t).done((function(e,t,r){e.error?n.reject(f._readableError(e.error)):e.success?n.resolve(e.result):n.reject(e.reason)})).fail((function(e){f._anyRequestAsyncFail(n,e)})),n.promise()},f.evalMetaInfoExprsAsync=function(e,n){a("Pine","ScriptLib.evalMetaInfoExprs");var t=i.Deferred(),r={username:window.user&&window.user.username,source:e,inputs:JSON.stringify(n||{})};return f._pineFacadeAjax("POST","/eval_pine_ex/",r).done((function(e,n,r){e.error?t.reject(f._readableError(e.error)):e.success?t.resolve(e.result):t.reject(e.reason)})).fail((function(e){f._anyRequestAsyncFail(t,e)})),t.promise()},f.patchPropertiesAsync=function(e,n,t){return u.logNormal("patchPropertiesAsync"),new Promise((function(r,i){if(n.TVScriptMetaInfoExprs){var s=n.TVScriptMetaInfoExprs.tree,a=n.TVScriptMetaInfoExprs.patchMap;f.evalMetaInfoExprsAsync(s,t).done((function(n){for(var t=n.rootValues,i=Object.keys(a),s=0;s<i.length;s++){var c=i[s],u=t[a[c]],l=c.split(".");"defaults"===l[0]&&l.splice(0,1),o(l.length>1,"Unexpectedly short json path");for(var d=e,p=0;p<l.length-1;++p)d=d[l[p]];d[l[l.length-1]].setValue(u)}r(e)})).fail((function(e){i(e)}))}else r(e)}))},f.scriptUpdater=function(){return window.scriptUpdater},f.clearAllCaches=function(){f.clearIsAuthToCaches(),f.clearSavedScriptsCache()},f.clearIsAuthToCaches=function(e){e?Object.keys(f._cache).filter((function(n){return n.indexOf(e)>=0})).forEach((function(e){delete f._cache[e]})):f._isAuthCache=new _},f.clearSavedScriptsCache=function(e){delete f._userScriptsDfd},f.requestUserScripts=function(e){if(a("Pine","ScriptLib.requestUserScripts"),window.is_authenticated){if(!f._userScriptsDfd){f._userScriptsDfd=i.Deferred();var n=f._userScriptsDfd;f._pineFacadeAjax("GET","/list?filter=saved").done((function(e,t,r){n.resolve(e)})).fail((function(e){f._anyRequestAsyncFail(n,e)}))}n=f._userScriptsDfd}else n=i.Deferred().resolve([]);return"function"==typeof e&&n.done(e),n.promise()},f.setUserScripts=function(e){f._userScriptsDfd||(f._userScriptsDfd=i.Deferred().resolve(e))},f.requestUserPublishedScripts=function(e,n){if(a("Pine","ScriptLib.requestUserPublishedScripts"),window.is_authenticated){if(n||!f._userPublishedScriptsDfd){f._userPublishedScriptsDfd=i.Deferred();var t=f._userPublishedScriptsDfd;f._pineFacadeAjax("GET","/list?filter=published").done((function(e,n,r){t.resolve(e)})).fail((function(e){f._anyRequestAsyncFail(t,e)}))}t=f._userPublishedScriptsDfd}else t=i.Deferred().resolve([])
;return"function"==typeof e&&t.done(e),t.promise()},f.requestPineEditorNewTemplateScripts=function(e){a("Pine","ScriptLib.requestPineEditorNewTemplateScripts");var n=i.Deferred();return f._pineFacadeAjax("GET","/list/?filter=template",void 0,!0).done((function(e,t,r){n.resolve(e)})).fail((function(e){f._anyRequestAsyncFail(n,e)})),"function"==typeof e&&n.done(e),n.promise()},f.requestInfoForScripts=function(e){return Promise.all([f._pineFacadeAjax("GET","/list?filter=saved"),f._pineFacadeAjax("GET","/list?filter=addon",void 0,!0)]).then((function(n){var t=n[0],r=n[1];return t.concat(r).filter((function(n){return e.includes(n.scriptIdPart)}))}))},f.requestBuiltinScripts=function(){a("Pine","ScriptLib.requestBuiltinScripts"),u.logNormal("Request built-in scripts");var e=i.Deferred();return f._pineFacadeAjax("GET","/list/?filter=standard",void 0,!0).done((function(n,t,r){u.logNormal("Request built-in scripts finished"),e.resolve(n)})).fail((function(n){u.logWarn("Request built-in scripts finished with fail"),f._anyRequestAsyncFail(e,n)})),e.promise()},f.requestBuiltinAndUserScripts=function(){a("Pine","ScriptLib.requestBuiltinAndUserScripts"),u.logNormal("Request built-in and user scripts");var e,n=window.user&&window.user.username,t={},r=new Promise((function(n,r){e=n,t.reject=r}));return Promise.all([f._pineFacadeAjax("GET","/list?filter=saved&user_name="+encodeURIComponent(n),void 0,!1),f._pineFacadeAjax("GET","/list?filter=standard",void 0,!0)]).then((function(n){u.logNormal("Request built-in and user scripts finished");var t=n[0],r=n[1];e(t.concat(r))})).catch((function(e){u.logWarn("Request built-in and user scripts finished with fail"),f._anyRequestAsyncFail(t,e)})),r},f.requestScriptInfo=function(e){a("Pine","ScriptLib.requestBuiltinAndUserScripts"),u.logNormal("Request public/user script info");var n=i.Deferred();return f._pineFacadeAjax("GET","/get_script_info/?pine_id="+encodeURIComponent(e)).done((function(e){u.logNormal("Request public/user script info finished"),n.resolve(e)})).fail((function(e){u.logWarn("Request public/user script info finished with fail"),f._anyRequestAsyncFail(n,e)})),n.promise()},f.requestCandlestickScripts=function(){var e;a("Pine","ScriptLib.requestCandlestickScripts"),u.logNormal("Request candlestick scripts");var n={},t=new Promise((function(t,r){e=t,n.reject=r}));return f._pineFacadeAjax("GET","/list?filter=candlestick",void 0,!0).done((function(n){u.logNormal("Request candlestick scripts finished"),e(n)})).fail((function(e){u.logWarn("Request candlestick scripts finished with fail"),f._anyRequestAsyncFail(n,e)})),t};var v={time:-1/0,request:null};f.requestFundamentalScripts=function(){if(v.time+6e5>Date.now()&&null!==v.request)return u.logNormal("Return fundamentals from cache"),v.request;u.logNormal("Request fundamental scripts");var e=f._pineFacadeAjax("GET","/list?filter=fundamental",void 0,!1);return e.then((function(e){u.logNormal("Request fundamental scripts finished")})),e.fail((function(e){u.logWarn("Request fundamental scripts finished with fail, resetting cache"),
v.request=null})),v.time=Date.now(),v.request=Promise.resolve(e.promise()),v.request},f.requestPineAddons=function(e){a("Pine","ScriptLib.requestPineAddons");var n=i.Deferred();return f._pineFacadeAjax("GET","/list?filter=addon&pine_id_prefix="+e).done((function(e){n.resolve(e)})).fail((function(e){f._anyRequestAsyncFail(n,e)})),n},f._updateAliveScriptInstances=function(e,n){var t={};t.scriptMetaInfo=e.result.metaInfo,t.scriptVersionToUpdate=n,c.emit("TVScriptModified",JSON.stringify(t)),d.emit("TVScriptModified",t),setTimeout((function(){t.isSelfCall=!0,null!=f.scriptUpdater()&&f.scriptUpdater().onTVScriptModified(t)}),0)},f.saveNew=function(e,n,t,r){a("Pine","ScriptLib.saveNew");var o=i.Deferred();if(null==e||""===e)return o.reject(s("Cannot save empty source code"));var c=window.user&&window.user.username,u=t?"&allow_overwrite=true":"",l="/save/new/?name="+encodeURIComponent(n)+"&user_name="+encodeURIComponent(c)+u,d={source:e};return f._pineFacadeAjax("POST",l,d).done((function(e,n,t){f.clearSavedScriptsCache(),f._updateAliveScriptInstances(e,r),f._saveScriptAsyncDone(o,e)})).fail((function(e,n,t){f._anyRequestAsyncFail(o,e)})),o.promise()},f.saveNext=function(e,n,t,r,o){a("Pine","ScriptLib.saveNext");var c=null!=t?"&name="+encodeURIComponent(t):"",u=i.Deferred();if(null==n||""===n)return u.reject(s("Cannot save empty source code"));var l=window.user&&window.user.username,d="/save/next/"+encodeURIComponent(e)+"/?user_name="+encodeURIComponent(l)+"&allow_create_new="+!!o+c,p={source:n};return f._pineFacadeAjax("POST",d,p).done((function(e,n,t){f.clearSavedScriptsCache(),f._updateAliveScriptInstances(e,r),f._saveScriptAsyncDone(u,e)})).fail((function(e,n,t){f._anyRequestAsyncFail(u,e)})),u.promise()},f.deletePine=function(e){a("Pine","ScriptLib.deletePine");var n=i.Deferred(),t=window.user&&window.user.username,r="/delete/"+encodeURIComponent(e)+"/?user_name="+encodeURIComponent(t);return f._pineFacadeAjax("POST",r).done((function(t,r,i){f.clearIsAuthToCaches(e),f.clearSavedScriptsCache(),n.resolve(t);var s={scriptIdPart:e};c.emit("TVScriptDeleted",JSON.stringify(s)),d.emit("TVScriptDeleted",s),setTimeout((function(){s.isSelfCall=!0,null!=f.scriptUpdater()&&f.scriptUpdater().onTVScriptDeleted(s),f._pineDeleted.fire(e)}),0)})).fail((function(e,t,r){f._anyRequestAsyncFail(n,e)})),n.promise()},f.renamePine=function(e,n,t){a("Pine","ScriptLib.renamePine");var r=i.Deferred(),s=window.user&&window.user.username,o="/rename/"+encodeURIComponent(e)+"/?name="+encodeURIComponent(n)+"&user_name="+encodeURIComponent(s)+"&force="+encodeURIComponent(!!t);return f._pineFacadeAjax("POST",o).done((function(t,i,s){f.clearSavedScriptsCache();var o={scriptIdPart:e,scriptName:n};c.emit("TVScriptRenamed",JSON.stringify(o)),d.emit("TVScriptRenamed",o),setTimeout((function(){o.isSelfCall=!0,null!=f.scriptUpdater()&&f.scriptUpdater().onTVScriptRenamed(o)}),0),r.resolve(t)})).fail((function(e,n,t){f._anyRequestAsyncFail(r,e)})),r.promise()},f.publishNew=function(e,n){a("Pine","ScriptLib.publishNew")
;var t=i.Deferred(),r=window.user&&window.user.username,s="/publish/new/?access="+encodeURIComponent(n)+"&user_name="+encodeURIComponent(r),o={source:e};return f._pineFacadeAjax("POST",s,o).done((function(e,n,r){e.success?(f.clearSavedScriptsCache(),t.resolve(e)):t.reject(e.reason)})).fail((function(e,n,r){f._anyRequestAsyncFail(t,e)})),t.promise()},f.publishNext=function(e,n){u.logNormal("ScriptLib.publishNext","pine"),a("Pine","ScriptLib.publishNext");var t=i.Deferred(),r=window.user&&window.user.username,s="/publish/next/"+encodeURIComponent(n)+"?user_name="+encodeURIComponent(r),o={source:e};return f._pineFacadeAjax("POST",s,o).done((function(e,n,r){f.clearSavedScriptsCache(),e.success||t.reject(e.reason),t.resolve(e)})).fail((function(e,n,r){f._anyRequestAsyncFail(t,e)})),t.promise()},f.lightTranslate=function(e,n){return u.logNormal("ScriptLib.lightTranslate","pine"),a("Pine","ScriptLib.lightTranslate"),new Promise((function(t,r){var i=window.user&&window.user.username,s=`/translate_light/?user_name=${encodeURIComponent(i)}`;n&&(s+=`&pine_id=${encodeURIComponent(n)}`);var o={source:e};f._pineFacadeAjax("POST",s,o).done((function(e,n,i){if(e.success)t(e.result);else{var s=e.result&&e.result.reason||e.reason;r(s)}})).fail((function(e,n,t){f._anyRequestAsyncFail({reject:r},e)}))}))},f.getLibList=function(e,n,t){return u.logNormal("ScriptLib.getLibList","pine"),a("Pine","ScriptLib.getLibList"),new Promise((function(r,i){var s="/lib_list?lib_id_prefix="+encodeURIComponent(e);n&&(s+="&ignore_cache=true"),t&&(s+="&ignore_case=true"),f._pineFacadeAjax("GET",s).done((function(e,n,t){r(e)})).fail((function(e,n,t){f._anyRequestAsyncFail({reject:i},e)}))}))},f.getExistingLibraryInfo=async function(e){try{const n=await f.getLibList(e+"/last",!0,!0);if(!n.length)return null;const t=n[0];return{scriptIdPart:t.scriptIdPart,chartId:t.chartId,version:t.version}}catch(e){return null}},loginStateChange.subscribe(f,f.clearAllCaches),e.exports=f},281640:(e,n,t)=>{var r;e=t.nmd(e),"undefined"!=typeof window&&(r=window.TVScript=window.TVScript||{}),(r=r||{}).Access={},r.Access.ACCESS_OPEN_NO_AUTH="open_no_auth",r.Access.ACCESS_CLOSED_NO_AUTH="closed_no_auth",r.Access.ACCESS_CLOSED_NEEDS_AUTH="closed_needs_auth",r.Access.MAP_ID_TO_NAME={1:r.Access.ACCESS_OPEN_NO_AUTH,2:r.Access.ACCESS_CLOSED_NO_AUTH,3:r.Access.ACCESS_CLOSED_NEEDS_AUTH},r.Access.MAP_NAME_TO_ID={},Object.keys(r.Access.MAP_ID_TO_NAME).forEach((function(e){r.Access.MAP_NAME_TO_ID[r.Access.MAP_ID_TO_NAME[e]]=e})),r.PinePrefix={},r.PinePrefix.USER="USER;",r.PinePrefix.PUB="PUB;",r.PinePrefix.STD="STD;",r.PinePrefix.TV="TV_",r.PinePrefix.EDGR="EDGR_",r.PineType={},r.PineType.UserSaved="PineType_UserSaved",r.PineType.UserPublished="PineType_UserPublished",r.PineType.BuiltIn="PineType_BuiltIn",r.PineType.Addon="PineType_Addon",r.Type=r.Type||function(){},r.Type.VOID="void",r.Type.INTEGER="integer",r.Type.FLOAT="float",r.Type.STRING="string",r.Type.BOOL="bool",r.Type.COLOR="color",r.Type.SERIES="series",r.Type.PLOT="plot",r.Type.HLINE="hline",r.Type.BARCOLOR="barcolor",
r.Type.BGCOLOR="bgcolor",r.Type.PLOTSHAPES="plotshape",r.Type.PLOTCHARS="plotchar",r.Type.PLOTARROWS="plotarrow",r.Type.NA="na",r.Type.ARRAY="array",r.TranslatorDefaultVersion=1,r.TranslatorReferenceVersioningIntroduced=4,r.TranslatorLastVersion=5,r.pineType=function(e){return e.startsWith(r.PinePrefix.USER)?r.PineType.UserSaved:e.startsWith(r.PinePrefix.PUB)?r.PineType.UserPublished:e.startsWith(r.PinePrefix.STD)||e.startsWith(r.PinePrefix.TV)||e.startsWith(r.PinePrefix.EDGR)?r.PineType.BuiltIn:r.PineType.Addon},r.patchILTemplate=function(e,n,t){var i=t||{};return r._patchTemplate(/<(in_\d+)>/g,e,n,i)},r.decorateQuotes=function(e){if(!e)return e;var n=/([^\\']+?)(')[^']*?/g,t="$1\\$2",r=e;return"'"==r.charAt(0)&&"'"==r.charAt(r.length-1)?"'"+(r=r.substr(1,r.length-2)).replace(n,t)+"'":r.replace(n,t)},r.patchInputs=function(e,n){var t={};for(var r in e)if(e.hasOwnProperty(r)){var i,s=e[r];i=s.isFake?{v:n[s.id],f:!0,t:s.type}:n[s.id],t[s.id]=i}return t},r._patchTemplate=function(e,n,t,i){var s=i||{};return n.replace(e,(function(e,n){for(var i=(n in s?s[n]:t.defaults.inputs[n]),o=0;o<t.inputs.length;++o)if(t.inputs[o].id===n)if("bool"===t.inputs[o].type)i=i?"1.0":"0.0";else if(["text","symbol","resolution","session"].indexOf(t.inputs[o].type)>=0)i="'"+r.decorateQuotes(i)+"'";else if("source"===t.inputs[o].type){var a=i.split("$");a[0]="'"+a[0]+"'",i="source("+a.join(",")+")"}return i}))},r.isStrategy=function(e){return/^\s*strategy\s*\(/m.test(e)};var i=/^\s*\/\/\s*?@version\s*?=\s*?(\S*?)\s*?$/gm,s=/^[0-9]+$/;r.extractVersion=function(e){i.lastIndex=0;var n=i.exec(e);if(null===n)return 1;var t=n[1],o=s.test(t)?Number(t):NaN;return isNaN(o)?1:Math.max(r.TranslatorDefaultVersion,Math.min(o,r.TranslatorLastVersion))},r.canUpgradeVersion=function(e){return e>=3&&e<r.TranslatorLastVersion},r.canDowngradeVersion=function(e){return e>=4&&e<=r.TranslatorLastVersion},e&&e.exports&&(e.exports=r)},844853:(e,n,t)=>{"use strict";t.d(n,{showGoProAlertsOnSecondsDialog:()=>i});var r=t(629588);function i(){(0,r.createGoProDialog)({feature:"alertsOnSeconds"})}},746511:(e,n,t)=>{"use strict";function r(e){let n;if("object"!=typeof e||null==e||"number"==typeof e.nodeType)n=e;else if(e instanceof Date)n=new Date(e.valueOf());else if(Array.isArray(e)){n=[];let t=0;const i=e.length;for(;t<i;t++)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=r(e[t]))}else{n={};for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=r(e[t]))}return n}t.d(n,{deepCopy:()=>r})},520533:(e,n,t)=>{"use strict";function r(e){return"scriptTitle"in e&&"modified"in e}function i(e){return"userId"in e&&"scriptAccess"in e}function s(e){return"strategy"===e.kind}function o(e){return"library"===e.kind}t.d(n,{isSavedPineInfo:()=>r,isPubPineInfo:()=>i,isScriptStrategy:()=>s,isScriptLibrary:()=>o})}}]);